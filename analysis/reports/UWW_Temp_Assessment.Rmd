---
title: "Summer Stream Temperature Assessment, Upper Walla Walla Watershed"
author:
- Michael W. Ackerman:
    email: mike.ackerman@mthoodenvironmental.com
    institute: mhe_mccall
    correspondence: yes
- Bryce N. Oldemeyer:
    email: bryce.oldemeyer@mthoodenvironmental.com
    institute: mhe_challis
    correspondence: yes
- Mark Roes:
    email: mark.roes@mthoodenvironmental.com
    institute: mhe_sandy
    correspondence: no
date: "`r format(Sys.time(), '%d %B, %Y')`"
output:
  bookdown::html_document2:
    theme: yeti
    toc: yes
    toc_depth: 3
    toc_float:
      collapsed: yes
      smooth_scroll: yes
    number_sections: yes
    pandoc_args:
    - "--lua-filter=../templates/scholarly-metadata.lua"
    - "--lua-filter=../templates/author-info-blocks.lua"
    - "--lua-filter=../templates/pagebreak.lua"
  bookdown::word_document2:
    fig_caption: yes
    reference_docx: "../templates/template.docx" # Insert path for the DOCX file
    number_sections: FALSE
    toc: no
    always_allow_html: true
    fig_width: 6
    pandoc_args:
    - --lua-filter=../templates/scholarly-metadata.lua
    - --lua-filter=../templates/author-info-blocks.lua
    - --lua-filter=../templates/pagebreak.lua
institute:
- mhe_mccall: Mount Hood Environmental, PO Box 4282, McCall, Idaho, 83638, USA
- mhe_challis: Mount Hood Environmental, PO Box 1303, Challis, Idaho 83226, USA
- mhe_sandy: Mount Hood Environmental, 39085 Pioneer Boulevard \#100 Mezzanine, Sandy,
    Oregon, 97055, USA
csl: "../templates/journal-of-archaeological-science.csl"
bibliography: AckermanLibrary.bib
always_allow_html: yes
---

<!-- the following inserts MHE logo into header -->

```{=html}
<script>
   $(document).ready(function() {
     $head = $('#header');
     $head.prepend('<img src=\"logo.jpg\" style=\"float: right;width: 150px;\"/>')
   });
</script>

<style>
p.caption {
  font-size: 0.8em;
}
</style>
```

```{r setup, echo = FALSE, message = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  warning = FALSE,
  message = FALSE,
  echo = FALSE,
  comment = "#>",
  fig.path = "../figures/",
  dpi = 600
)

options(knitr.kable.NA = '--')

```

```{r load-libraries}
# run this if running chunks directly

# for formatting
library(kableExtra)
library(ggpubr)

# for analysis
library(sf)
library(here)
library(tidyverse)
library(magrittr)
library(ggmap)
library(nngeo)
library(janitor)

theme_set(theme_pubr(x.text.angle = 45,
                     base_size = 8))

```

```{r load-data, results = "hide"}
# Project area polygons and 200m layer (with habitat attributes) within project area
load(here("analysis/data/derived_data/uww_spatial.rda"))

uww_rch_sf = uww_rch_sf %>%
  mutate(lamp = T,
         bull = as.logical(bull))

domain_km = uww_rch_sf %>%
  select(chnk, sthd, bull, lamp, reach_leng) %>%
  st_drop_geometry() %>%
  pivot_longer(cols = chnk:lamp,
               names_to = "species") %>%
  filter(value == T) %>%
  group_by(species) %>%
  summarize(domain_km = round(sum(reach_leng) / 1000, 1))

uww_rch_sf_w_geos = st_read(here("analysis/data/raw_data/Bull_Geo_Cleaned_rch_200.shp"))

```

# Background

Water is the cornerstone of First Foods production and inherently tied to the five fundamental touchstones: hydrology, geomorphology, habitat and network connectivity, riverine biotic community, and riparian vegetation [@Jones2008]. These touchstones form the Umatilla River Vision, a holistic approach to water quality restoration. Stream temperature is a critical component of the hydrology of the Upper Walla Walla watershed, directly affecting the fish community and the connectivity of their habitat. Warming climatic conditions are expected to have pronounced effects on salmonids [@Kovach2016]. In the Pacific Northwest, summer months are anticipated to become progressively more stressful for cold-water species as stream temperatures increase with warming air temperatures, which is likely to shift and reduce suitable habitat for many species [@Isaak2015; @Jones2014]. Here, we evaluate recent historic and future projected summer stream temperature scenarios [@Isaak2017a] for the Upper Walla Walla watershed and compare them to life-stage specific temperature threshholds for focal species. The goal of this assessment was to determine whether summer stream temperature were a potential factor limiting fish population productivity and to identify if and where restoration actions (e.g., riparian planting, improved grazing practices) aimed at reducing stream temperatures could be considered to help mitigate future impacts of a warming climate.

## Objectives

The primary objectives of the Upper Walla Walla summer stream temperature assessment include:

1.  Summarize recent historic and future projected summer stream temperature scenarios for the Upper Walla Walla [@Isaak2017a].

2.  Compare recent historic and future projected summer stream temperature scenarios in the Upper Walla Walla to life stage specific temperature thresholds for focal species to determine whether stream temperatures may hinder their productivity.

3.  Evaluate a hypothetical scenario where restoration efforts (e.g., riparian planting, improved grazing practices, etc.) over the next approximately 60 years decrease summer stream temperatures relative to recent historic temperatures by 1^o^C.

# Methods

Recent historic (2002-2011) and projected (2040 & 2080) August mean stream temperature predictions [@Isaak2017a] were used in combination with life stage specific temperature thresholds available from the literature for focal species (Table \@ref(tab:temp-thresh)) to evaluate potential habitat limitations within the upper Walla Walla River watershed. To accomplish this, modeled recent historic and projected August mean stream temperatures were used to quantify the amount of stream habitat exceeding optimum, maximum, and acute temperature thresholds for focal species present in the Upper Walla Walla watershed during summer months. Additionally, a scenario where hypothetical restoration actions reduced mean August stream temperatures by 1^o^C relative to the recent historic temperature scenario was evaluated to illustrate the benefits restoration actions could provide for thermal suitability of habitat within the watershed.

## Focal Species

The focal species for the summer temperature assessment include:

-   Spring-run Chinook salmon (*Oncorhynchus tshawytscha*; hereafter Chinook salmon)
-   Middle Columbia River summer steelhead (*O. mykiss*; hereafter steelhead; ESA-listed "threatened")
-   Columbia River bull trout (*Salvelinus confluentus*; ESA-listed "threatened")
-   Pacific lamprey (*Lampetra tridentata*)

## Study Area

The summer stream temperature assessment included the upper Walla Walla River from its confluence with Dry Creek near Lowden, Washington, to the headwaters of the North Fork and South Fork Walla Walla rivers, including tributaries (Figure \@ref(fig:uww-nrws-dist)). Temperature predictions for streams used in the assessment were pulled from the NorWeST regional database [@Isaak2017a]. For Chinook salmon, steelhead, and bull trout we truncated the evaluation to include the spatial distributions currently used by each species as defined by StreamNet (Table \@ref(tab:study-area)). A distribution is not available for Pacific lamprey in StreamNet, and thus, we included the entirety of the modeled extent in the Upper Walla Walla watershed available from NorWeST (Table \@ref(tab:study-area)).

```{r uww-nrws-dist, out.width = "100%", fig.cap = "Stream extents for the Upper Walla Walla watershed modeled as part of the NorWeST regional database (Isaak et al. 2017). Primary rivers and tributaries used by Chinook salmon, steelhead, and bull trout are labeled in the map."}
knitr::include_graphics("../maps/UWW_NorWeST.png")

```

```{r study-area}
study_tab = uww_rch_sf %>%
  select(GNIS_Name, chnk, sthd, bull, reach_leng, S2_02_11) %>%
  st_drop_geometry() %>%
  filter(chnk == T | sthd == T | bull == T,
         !is.na(S2_02_11)) %>%
  group_by(GNIS_Name) %>%
  summarize(`Chinook Salmon`  = round(sum(reach_leng[chnk == T]) / 1000, 1),
            `Steelhead`       = round(sum(reach_leng[sthd == T]) / 1000, 1),
            `Bull Trout`      = round(sum(reach_leng[bull == T]) / 1000, 1),
            `Pacific Lamprey` = round(sum(reach_leng) / 1000, 1)) %>%
  mutate_all(~na_if(., 0)) %>%
  rename(`Stream Name` = GNIS_Name) %>%
  adorn_totals() %>%
  mutate(`Stream Name` = ifelse(is.na(`Stream Name`), "Unnamed Creek(s)", `Stream Name`)) %>%
  kable(booktabs = T,
        align = "lcccc",
        caption = "River and tributaries within the spatial distribution of Chinook salmon, steelhead, and bull trout (as defined by StreamNet) in the Upper Walla Walla watershed. No distribution is available for Pacific lamprey in StreamNet; therefore, the entirety of the modeled NorWeST extent was used for Pacific lamprey.") %>%
  kable_styling(full_width = F,
                position = "center",
                bootstrap_options = c("striped", "condensed"))
study_tab  

```

## Temperature Scenarios

Three NorWeST summer stream temperature scenarios were considered. The first "Recent Historic" is intended to represent a contemporary scenario whereas the 2040 and 2080 represent mid-century and late-century climate warming scenarios, respectively. Definitions of each scenario are as follows:

-   **Recent Historic** (S2_02_11): A historical composite scenario representing the 10-year average August mean stream temperatures for 2002-2011 [@Isaak2017a].

-   **2040 Projected** (S30_2040D): A future August mean stream temperature scenario based on average projected changes in August air temperature and stream discharge for the 2040s (2030-2059). Projected changes in streams accounted for differential sensitivity among streams so that cold streams warm less than warm streams [@Isaak2017a].

-   **2080 Projected** (S32_2080D): A future August mean stream temperature scenario based on average projected changes in August air temperature and stream discharge for the 2080s (2070-2099). Projected changes in streams accounted for differential sensitivity among streams so that cold streams warm less than warm streams [@Isaak2017a].

We also considered a (very) hypothetical scenario (**Recent Minus 1^o^C**) in which summer stream temperatures were reduced by 1^o^C relative to the recent historic scenario. This scenario represents a situation where various restoration actions (e.g., riparian planting, improved land use practices) increases stream shading, reduced solar loading, and/or increased hyporheic exchange within the watershed resulting in cooler August stream temperatures. Each of the scenarios are summarized in Figures \@ref(fig:norwest) and \@ref(fig:norwest-bp).

```{r norwest, fig.cap = "Modeled average August stream temperatures within the Upper Walla Walla watershed for each of the NorWeST scenarios considered."}
norwest_df = uww_rch_sf %>%
  select(chnk,
         sthd,
         bull,
         lamp,
         `Recent Historic` = S2_02_11,
         `2040 Projected` = S30_2040D,
         `2080 Projected` = S32_2080D,
         reach_leng) %>%
  mutate(`Recent Historic` = replace(`Recent Historic`, `Recent Historic` == -9999.00, NA),
         `2040 Projected` = replace(`2040 Projected`, `2040 Projected` == -9999.00, NA),
         `2080 Projected` = replace(`2080 Projected`, `2080 Projected` == -9999.00, NA),
         `Recent Minus 1` = `Recent Historic` - 1) %>%
  pivot_longer(cols = c("Recent Minus 1",
                        "Recent Historic",
                        "2040 Projected",
                        "2080 Projected"),
               names_to = "scenario",
               values_to = "temp_c") %>%
  mutate(scenario = factor(scenario, levels = c("Recent Minus 1",
                                                "Recent Historic", 
                                                "2040 Projected", 
                                                "2080 Projected"))) 

river_color = "lightskyblue1"
norwest_p = norwest_df %>%
  ggplot() +
  geom_sf(data = uww_huc_sf %>%
            st_union(),
          fill = NA,
          color = "gray50",
          size = 0.5) +
  geom_sf(color = river_color) +
  geom_sf(data = norwest_df,
          aes(color = temp_c),
          size = 0.5) +
  scale_color_viridis_c(option = "turbo") +
  facet_wrap(~scenario, 
             ncol = 2) +
  theme_bw() +
  theme(legend.position = "bottom",
        axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks = element_blank(),
        panel.grid.major = element_line(color = "transparent")) +
  labs(title = "Modeled summer stream temperatures",
       color = expression("Temperature ("^o*"C)"))
norwest_p

```

```{r norwest-bp, out.width = "70%", fig.align = "center", fig.cap = "Distribution of average August stream temperatures throughout streams in the Upper Walla Walla watershed under each of the NorWeST scenarios considered."}
norwest_bp = norwest_df %>%
  group_by(scenario) %>%
  mutate(avg_temp = mean(temp_c, na.rm = T)) %>%
  ggplot(aes(x = reorder(scenario, temp_c),
             y = temp_c)) +
  geom_boxplot(aes(fill = avg_temp)) +
  scale_fill_viridis_c(option = "turbo",
                       name = expression("Mean Temp ("^o*"C)")) +
  theme_bw() +
  labs(y = expression("Temperature ("^o*"C)")) +
  theme(axis.title.x = element_blank(),
        axis.text.x = element_text(size = 12,
                                   color = "black"),
        axis.text.y = element_text(size = 12,
                                   color = "black"),
        legend.position = "none")
norwest_bp

```

## Fish Temperature Threshholds

Temperature thresholds for Chinook salmon and steelhead were evaluated based on life-stage(s) that occupy habitat in the Upper Walla Walla watershed in August. Spawning and summer parr life-stages were considered for Chinook salmon and the summer parr life-stage was considered for steelhead. Temperature thresholds (expressed as the maximum weekly maximum temperature [MWMT]) identified in a literature review conducted by @Carter2005 were used for Chinook salmon and steelhead thresholds in this assessment. Chinook spawning was observed over a wide range of temperatures (5.6 - 17.7^o^C); however, a majority of observations cite maximum temperatures at 14.5^o^C. For juvenile Chinook salmon summer parr rearing, 10 - 16^o^C represented an optimal range for growth and rearing. Temperatures above 19^o^C generally did not support Chinook salmon parr growth and Chinook salmon parr were rarely found in reaches with temperatures greater than 22^o^C. Juvenile steelhead summer parr temperature tolerances were similar to those of Chinook salmon, but had a higher end to their optimal range (18^o^C) for growth and rearing.

Bull trout tended to have more specific habitat requirements compared to other salmonids, typically needing colder stream temperatures. Although bull trout have been reported in stream temperatures above 20^o^C, they are seldom found in waters where temperatures exceed 15 - 16^o^C. Temperatures above 16^o^C are detrimental for bull trout feeding and growth and are unlikely to be suitable for their long-term survival [@Selong2001 and references therein]. At temperatures greater than 18^o^C, bull trout exhibit reduced consumption, growth, and survival [@Selong2001].

Pacific lamprey can tolerate a temperature range of 5 - 25^o^C [@Clemens2017]. Pacific lamprey spawning typically occurs between 10 - 18^o^C with early juvenile development between 14 - 19^o^C, and preferred temperatures by adults ranging from 16 - 17^o^C [@Clemens2016; @Clemens2017]. Temperatures greater than 19^o^C are typically associated with stress, tissue damage, and potential mortality in Pacific lamprey [@Clemens2016]. Temperature thresholds along with descriptions of the thresholds are shown in Tables \@ref(tab:temp-thresh) and \@ref(tab:temp-desc), respectively.

```{r temp-thresh}
temp_thresh_tab = tibble(Species = c("Chinook", "Chinook", "Steelhead", "Bull Trout", "Pacific Lamprey"),
                         `Life Stage` = c("Spawning", "Summer Parr", "Summer Parr", "All", "All"),
                         Source = c("Carter 2005", "Carter 2005", "Carter 2005", "Selong et al. 2001", "Clemens et al. 2016, 2017"),
                         Timing = c("8/10 - 9/30", "6/10 - 10/15", "6/10 - 10/15", "7/1 - 8/31", "7/1 - 8/31"),
                         Minimum = c("3.3", "4.5", "4.5", "0", "5"),
                         Optimum = c("7.2 - 14.5", "10 - 16", "10 - 18", "10.2 - 16", "10 - 17"),
                         Maximum = c("17.7", "19", "19", "18", "20"),
                         Acute = c("20", "22", "22", "20", "25")) %>%
  kable(booktabs = T,
        align = "cccccccc",
        caption = "Life stage timing and minimum, optimum, maximum, and acute temperature (Celcius) thresholds for summer life-stages of Chinook salmon, steelhead, bull trout, and Pacific lamprey. Chinook salmon and steelhead temperatures are expressed as the 7-day Maximum Weekly Maximum Temperature (MWMT).") %>%
  kable_styling(full_width = F,
                position = "center",
                bootstrap_options = c("striped", "condensed"))
temp_thresh_tab

```

```{r temp-desc}
temp_desc = tibble(Term = c("MWMT", "Minimum", "Optimum", "Maximum", "Acute"),
                   Description = c("The maximum weekly maximum temperature (also known as the seven-day average of daily maximum temperatures (7-DADM)) is the maximum of the daily maximum temperatures over a running seven-day consecutive period. The MWMT is useful because is describes the maximum temperatures in a stream, but is not overly influenced by the maximum temperature of a single day.",
                   "A temperature below which physiological stress occurs including reduced growth and activity. Prolonged exposure below this temperature can lead to eventual mortality.",
                   "The optimum or preferred stream temperature that fish most frequently inhabit when allowed to freely select temperatures in a thermal gradient (USEPA 1999). Also described as those temperatures at which growth rates are maximal (Armour 1991).",
                   "A temperature above which physiological stress occurs including reduced growth and activity. Prolonged exposure above this temperature can lead to eventual mortality.",
                   "An instantaneous maximum temperature above which can be lethal in a relatively short period of time.")) %>%
  kable(booktabs = T,
        align = "cc",
        caption = "Descriptions of maximum weekly maximum temperature and temperature thresholds used in the assessment.") %>%
  kable_styling(full_width = F,
                position = "center",
                bootstrap_options = c("striped", "condensed"))
temp_desc

```

## Approach

To consider the potential impacts of summer stream temperatures on the species and life stages of interest, we performed four separate analyses using the climate scenarios and temperature thresholds described above:

1. First, we considered whether recent composite or mid- or late-century summer stream temperature predictions in the Upper Walla Walla watershed fell within optimum temperature ranges (Table \@ref(tab:temp-thresh)) for each species and life stage. We estimated the percentage, by length, of the stream network that fell within optimum temperature thresholds. For this evaluation, we considered the entire NorWeST modeled extent, not just the species distributions from StreamNet, as distributions could potentially expand further into headwater reaches as partial or full migration barriers are removed or temperature warm and become more suitable in cool, headwater areas, or both.  

2. Second, we evaluated stream reaches estimated to exceed optimum, maximum, and acute temperature thresholds under the recent composite and mid- and late-century temperature scenarios. In this analysis, we considered each species and life stage, independently, and identified reahes that exceed thresholds under the recent historic scenario plus additional reaches that may be "lost" as stream temperatures warm in the future modeled scenarios. Here, we focused on the current spatial domains for each species as provided by StreamNet. For each species and life stage, we estimated the length of stream that falls above each threshold and for each climate scenario.

3. Then, we considered the theoretical cooling scenario where summer stream temperatures were decreased by 1^o^C relative to the recent historic scenario. We estimated the length of stream within the Upper Walla Walla watershed that would be "gained" (i.e., fall below optimum, maximum, and acute temperature thresholds) relative to the recent composite scenario for each species and life stage.

4. Finally, August mean stream temperatures under the recent historic scenario were summarized by geomorphic reaches. The goal was to determine whether summer stream temperatures are of a concern, by geomrphic reach, potentially limiting the distribution and/or productivity of each species and life stage, spatially, to inform prioritization efforts. For each geomorphic reach, we estimated the percentage, by length, that exceeds optimum, maximum, and acute thresholds by species and life stage. We used this information to determine a "thermal priority" for each reach. We averaged the percentage of each reach above optimum temperature thresholds among species and life stages; reaches with 0% above optimum for all species were listed as "Low" priority whereas reaches between 0% and 50% were "Medium" and reaches with greater than or equal to 50% above optimum thresholds were listed as "High" priority.

# Results

## Optimum Temperature Ranges

```{r temp-suit-tab}
spec_ls = c("Chinook Spawning", "Chinook Parr", "Steelhead Parr", "Bull Trout", "Pacific Lamprey")
thresh = c("Within Optimum", "Above Optimum", "Above Maximum", "Above Acute")

temp_tbl = norwest_df %>%
  expand_grid(spec_ls, thresh) %>%
  mutate(in_thresh = case_when(
    spec_ls == "Chinook Spawning" & thresh == "Within Optimum" & chnk == T & temp_c >= 7.2 & temp_c <= 14.5 ~ T,
    spec_ls == "Chinook Spawning" & thresh == "Above Optimum" & chnk == T & temp_c > 14.5 ~ T,
    spec_ls == "Chinook Spawning" & thresh == "Above Maximum" & chnk == T & temp_c > 17.7 ~ T,
    spec_ls == "Chinook Spawning" & thresh == "Above Acute" & chnk == T & temp_c > 20 ~ T,
    spec_ls == "Chinook Parr" & thresh == "Within Optimum" & chnk == T & temp_c >= 10 & temp_c <= 16 ~ T,
    spec_ls == "Chinook Parr" & thresh == "Above Optimum" & chnk == T & temp_c > 16 ~ T,
    spec_ls == "Chinook Parr" & thresh == "Above Maximum" & chnk == T & temp_c > 19 ~ T,
    spec_ls == "Chinook Parr" & thresh == "Above Acute" & chnk == T & temp_c > 22 ~ T,
    spec_ls == "Steelhead Parr" & thresh == "Within Optimum" & sthd == T & temp_c >= 10 & temp_c <= 18 ~ T,
    spec_ls == "Steelhead Parr" & thresh == "Above Optimum" & sthd == T & temp_c > 18 ~ T,
    spec_ls == "Steelhead Parr" & thresh == "Above Maximum" & sthd == T & temp_c > 19 ~ T,
    spec_ls == "Steelhead Parr" & thresh == "Above Acute" & sthd == T & temp_c > 22 ~ T,
    spec_ls == "Bull Trout" & thresh == "Within Optimum" & bull == T & temp_c >= 10.2 & temp_c <= 16 ~ T,
    spec_ls == "Bull Trout" & thresh == "Above Optimum" & bull == T & temp_c > 16 ~ T,
    spec_ls == "Bull Trout" & thresh == "Above Maximum" & bull == T & temp_c > 18 ~ T,
    spec_ls == "Bull Trout" & thresh == "Above Acute" & bull == T & temp_c > 20 ~ T,
    spec_ls == "Pacific Lamprey" & thresh == "Within Optimum" & lamp == T & temp_c >= 10 & temp_c <= 17 ~ T,
    spec_ls == "Pacific Lamprey" & thresh == "Above Optimum" & lamp == T & temp_c > 17 ~ T,
    spec_ls == "Pacific Lamprey" & thresh == "Above Maximum" & lamp == T & temp_c > 20 ~ T,
    spec_ls == "Pacific Lamprey" & thresh == "Above Acute" & lamp == T & temp_c > 25 ~ T,
    TRUE ~ F ))

results_tbl = temp_tbl %>%
  select(spec_ls, 
         scenario, 
         thresh, 
         reach_leng, 
         in_thresh) %>%
  filter(scenario != "Recent Minus 1",
         in_thresh == T) %>%
  group_by(spec_ls,
           scenario,
           thresh) %>%
  summarize(length_km = round(sum(reach_leng) / 1000, 1)) %>%
  pivot_wider(names_from = thresh,
              values_from = length_km) %>%
  mutate(`Species Domain` = case_when(
    spec_ls == "Chinook Spawning" ~ domain_km$domain_km[domain_km$species == "chnk"],
    spec_ls == "Chinook Parr" ~ domain_km$domain_km[domain_km$species == "chnk"],
    spec_ls == "Steelhead Parr" ~ domain_km$domain_km[domain_km$species == "sthd"],
    spec_ls == "Bull Trout" ~ domain_km$domain_km[domain_km$species == "bull"],
    spec_ls == "Pacific Lamprey" ~ domain_km$domain_km[domain_km$species == "lamp"]
  )) %>%
  select(`Life Stage` = spec_ls,
         Scenario = scenario,
         `Within Optimum`,
         `Above Optimum`,
         `Above Maximum`,
         `Above Acute`,
         `Species Domain`) %>%
  arrange(match(`Life Stage`, c("Chinook Spawning", 
                                "Chinook Parr", 
                                "Steelhead Parr", 
                                "Bull Trout", 
                                "Pacific Lamprey")))

```

Many of the lower reaches in the Upper Walla Walla watershed appear outside of the optimum range for each species and life stage, presumably being too warm, even under the recent historic scenario (Figure \@ref(fig:within-optimum-map)). This is especially the case for Chinook salmon spawning with a maximum optimum temperature of 14.5^o^C, the lowest among species and life stages considered. Even in the case of steelhead parr rearing, with the highest optimum tolerance of 18^o^C, many lower reaches are too warm when considering the recent composite scenario. Conversely, the "Recent Historic" scenario depicts that headwater reaches are also often outside of optimum ranges, presumably being too cool during August, although this is typical and not considered a limiting factor.

The "2040 Projected" NorWeST panel indicates stream reaches that are considered to become "lost" or "gained" relative to recent composite conditions (Figure \@ref(fig:within-optimum-map)). The lost reaches are those that are predicted to become too warm (i.e., exceed optimum ranges) as air temperatures increase around mid-century whereas the gained reaches are those previously too cool, but warm up to be within optimum ranges. Similarly, the "2080 Projected" panel shows the same results, except relative to mid-century. Both the mid-century and late-century conditions demonstrate how optimum temperatures during August will likely shift upstream in the watershed as the climate warms. In other words, a larger extent of the lower watershed is predicted to exceed optimal ranges for each species and life stage over time; moreover, its expected that the magnitude of temperature exceedance will also increase (Figures \@ref(fig:norwest) and \@ref(fig:norwest-bp)). Some headwater reaches will warm to be within optimum reaches (Figure \@ref(fig:within-optimum-map)); however, in many cases, it may be difficult for some species to access those reaches.

The length of stream within optimal temperature thresholds, in some cases (e.g., bull trout and Pacific lamprey), may increase through time (Table \@ref(tab:within-optimum-tbl)). However, this is a result of headwater reaches warming to within optimal thresholds at a greater rate than downstream reaches exceeding thresholds. This result is considered further in the [Discussion] section.

```{r within-optimum-tbl}
results_tbl %>%
  select(-c(`Above Optimum`:`Species Domain`)) %>%
  pivot_wider(
    names_from = `Scenario`,
    values_from = `Within Optimum`
  ) %>%
  kable (booktabs = T,
         align = "cccc",
         caption = "The length (km) of stream that falls within optimum temperature ranges for each species and life stage and for each NorWeST stream temperature scenario evaluated. The entirety of the modeled NorWeST extent in the Upper Walla Walla watershed was considered.") %>%
  kable_styling(full_width = F,
                position = "center",
                bootstrap_options = c("striped", "condensed"))

```

```{r within-optimum-map, fig.width = 6, fig.height = 7, fig.cap = "Maps depicting modeled August mean stream temperatures scenarios where reaches were within optimal temperatures for summer life stages of focal species within the Upper Walla Walla watershed. *Lost* indicates reaches that were inside the optimal temperature during the prior scenarios but were outside optimal temperatures for the scenario. Conversely, *Gained* indicates reaches that were outside the optimal temperature during the prior scenarios but were within optimal temperatures for the scenario."}
within_optimum_df = norwest_df %>%
  filter(scenario != "Recent Minus 1") %>%
  mutate(`Chinook Spawning` = ifelse(temp_c > 14.5 | temp_c < 7.2, "Outside", "Within"),
         `Chinook Parr` = ifelse(temp_c > 16 | temp_c < 10, "Outside", "Within"),
         `Steelhead Parr` = ifelse(temp_c > 18 | temp_c < 10, "Outside", "Within"),
         `Bull Trout` = ifelse(temp_c > 16 | temp_c < 10.2, "Outside", "Within"),
         `Pacific Lamprey` = ifelse(temp_c > 17 | temp_c < 10, "Outside", "Within")) %>%
  mutate(geom_text = as.character(st_geometry(.))) %>%
  group_by(geom_text) %>%
  mutate(`Chinook Spawning` = case_when(
    lag(`Chinook Spawning`) == "Within" & temp_c > 14.5 ~ "Lost",
    is.na(lead(`Chinook Spawning`)) ~ `Chinook Spawning`,
    TRUE ~ `Chinook Spawning`
  )) %>%
  mutate(`Chinook Parr` = case_when(
    lag(`Chinook Parr`) == "Within" & temp_c > 16 ~ "Lost",
    is.na(lead(`Chinook Parr`)) ~ `Chinook Parr`,
    TRUE ~ `Chinook Parr`
  )) %>%
  mutate(`Steelhead Parr` = case_when(
    lag(`Steelhead Parr`) == "Within" & temp_c > 18 ~ "Lost",
    is.na(lead(`Steelhead Parr`)) ~ `Steelhead Parr`,
    TRUE ~ `Steelhead Parr`
  )) %>%
  mutate(`Bull Trout` = case_when(
    lag(`Bull Trout`) == "Within" & temp_c > 16 ~ "Lost",
    is.na(lead(`Bull Trout`)) ~ `Bull Trout`,
    TRUE ~ `Bull Trout`
  )) %>%
  mutate(`Pacific Lamprey` = case_when(
    lag(`Pacific Lamprey`) == "Within" & temp_c > 17 ~ "Lost",
    is.na(lead(`Pacific Lamprey`)) ~ `Pacific Lamprey`,
   TRUE ~ `Pacific Lamprey`
  )) %>%
  mutate(`Chinook Spawning` = case_when(
    `Chinook Spawning` == "Within" & lag(temp_c < 5.6) ~ "Gained",
    is.na(lag(`Chinook Spawning`)) ~ `Chinook Spawning`,
    TRUE ~ `Chinook Spawning`
  )) %>%
  mutate(`Chinook Parr` = case_when(
    `Chinook Parr` == "Within" & lag(temp_c < 10) ~ "Gained",
    is.na(lag(`Chinook Parr`)) ~ `Chinook Parr`,
    TRUE ~ `Chinook Parr`
  )) %>%
  mutate(`Steelhead Parr` = case_when(
    `Steelhead Parr` == "Within" & lag(temp_c < 10) ~ "Gained",
    is.na(lag(`Steelhead Parr`)) ~ `Steelhead Parr`,
    TRUE ~ `Steelhead Parr`
  )) %>%
  mutate(`Bull Trout` = case_when(
    `Bull Trout` == "Within" & lag(temp_c < 10.2) ~ "Gained",
    is.na(lag(`Bull Trout`)) ~ `Bull Trout`,
    TRUE ~ `Bull Trout`
  )) %>%
  mutate(`Pacific Lamprey` = case_when(
    `Pacific Lamprey` == "Within" & lag(temp_c < 10) ~ "Gained",
    is.na(lag(`Pacific Lamprey`)) ~ `Pacific Lamprey`,
   TRUE ~ `Pacific Lamprey`
  )) %>%
  select(-geom_text) %>%
  pivot_longer(cols = c("Chinook Spawning",
                        "Chinook Parr",
                        "Steelhead Parr",
                        "Bull Trout",
                        "Pacific Lamprey"),
               names_to = "spec_ls",
               values_to = "within_optimum") %>%
  mutate(spec_ls = factor(spec_ls, levels = c("Chinook Spawning",
                                              "Chinook Parr",
                                              "Steelhead Parr",
                                              "Bull Trout",
                                              "Pacific Lamprey")))

within_optimum_p = within_optimum_df %>%
  ggplot() +
  geom_sf(data = uww_huc_sf %>%
            st_union(),
          fill = NA,
          color = "gray50",
          size = 0.5) +
  #geom_sf(color = river_color) +
  geom_sf(data = within_optimum_df,
          aes(color = within_optimum),
          size = 0.5) +
  scale_color_manual(values = c("Outside" = "gray",
                                "Within" = river_color,
                                "Lost" = "orangered",
                                "Gained" = "darkgreen")) +
  facet_grid(spec_ls ~ scenario) +
  theme_bw() +
  theme(legend.position = "top",
        axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks = element_blank(),
        panel.grid.major = element_line(color = "transparent")) +
  labs(color = "Within Optimum Range")
within_optimum_p

```

## Threshold Exceedances

### Chinook Salmon Spawning

Under the "Recent Historic" scenario, 83.5 rkm of the Upper Walla Walla watershed is estimated to exceed optimum temperatures for Chinook salmon spawning during August (Table \@ref(tab:chnk-spw-map), Figure \@ref(fig:chnk-spw-map)). An additional 3.8 rkm is estimated to exceed optimum temperatures by mid-century and an additional 9.3 rkm by late-century. Likewise, 51.5 rkm and 13.4 rkm are estimated to exceed maximum and acute temperature thresholds for Chinook salmon spawning, respectively, under recent conditions, and both are anticipated to increase in future climate warming scenarios (Table \@ref(tab:chnk-spw-map), Figure \@ref(fig:chnk-spw-map)).

```{r chnk-spw-map, fig.cap = "Maps depicting where modeled August mean stream temperatures exceed optimum, maximum, and acute temperature thresholds for Chinook salmon spawning within the StreamNet spatial distribution of Chinook salmon in the Upper Walla Walla watershed. Three NorWeST scenarios are shown including a *Recent Historic* composite and two climate warming scenarios, including mid-century (2040) and late-century (2080) predictions. The *Recent Historic* scenario depicts where summer stream temperatures are currently estimated to exceed thresholds whereas the 2040 and 2080 scenarios depict where temperature exceedances are estimated to expand (*New Yes*)."}
results_tbl %>%
  filter(`Life Stage` == "Chinook Spawning") %>%
  select(-`Within Optimum`) %>%
  kable(booktabs = T,
        align = "cccccc",
        caption = "The length (km) of stream that falls above optimum, maximum, and acute temperature thresholds for Chinook salmon spawning within the Chinook salmon spatial domain defined by StreamNet, and for each NorWeST stream temperature scenario evaluated.") %>%
  kable_styling(full_width = F,
                position = "center",
                bootstrap_options = c("striped", "condensed"))

chnk_spw_df = temp_tbl %>%
  filter(chnk == T,
         spec_ls == "Chinook Spawning",
         thresh != "Within Optimum",
         scenario != "Recent Minus 1") %>%
  select(spec_ls,
         scenario,
         temp_c,
         geometry) %>%
  distinct() %>%
  mutate(Optimum = ifelse(temp_c > 14.5, "New Yes", "No"),
         Maximum = ifelse(temp_c > 17.7, "New Yes", "No"),
         Acute = ifelse(temp_c > 20.0, "New Yes", "No")) %>%
  st_as_sf() %>%
  mutate(geom_text = as.character(st_geometry(.))) %>%
  group_by(geom_text) %>%
  mutate(Optimum = case_when(
    lag(Optimum) == "New Yes" ~ "Yes",
    is.na(lead(Optimum)) ~ Optimum,
    scenario == "Recent Historic" & Optimum == "New Yes" ~ "Yes",
    TRUE ~ Optimum
  )) %>%
  mutate(Maximum = case_when(
    lag(Maximum) == "New Yes" ~ "Yes",
    is.na(lead(Maximum)) ~ Maximum,
    scenario == "Recent Historic" & Maximum == "New Yes" ~ "Yes",
    TRUE ~ Maximum
  )) %>%
  mutate(Acute = case_when(
    lag(Acute) == "New Yes" ~ "Yes",
    is.na(lead(Acute)) ~ Acute,
    scenario == "Recent Historic" & Acute == "New Yes" ~ "Yes",
    TRUE ~ Acute
  )) %>%
  select(-geom_text) %>%
  pivot_longer(cols = c("Optimum",
                        "Maximum",
                        "Acute"),
               names_to = "thresh") %>%
  mutate(thresh = factor(thresh, levels = c("Optimum",
                                            "Maximum",
                                            "Acute")))

chnk_spw_p = chnk_spw_df %>%
  ggplot() +
  geom_sf(data = chnk_spw_df %>%
            st_union(),
          fill = NA,
          color = "gray70",
          size = 0.7) +
  geom_sf(data = chnk_spw_df,
          aes(color = value),
          size = 0.7) +
  scale_color_manual(values = c("Yes" = "mediumblue",
                                "New Yes" = "orangered",
                                "No" = river_color)) +
  facet_grid(thresh ~ scenario) +
  theme_bw() +
  theme(legend.position = "top",
        axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks = element_blank(),
        panel.grid.major = element_line(color = "transparent")) +
  labs(color = "Above Threshold")
chnk_spw_p

```

### Chinook Salmon Parr

Under the "Recent Historic" scenario, 67.9 rkm of the Upper Walla Walla watershed is estimated to exceed optimum temperatures for Chinook salmon juvenile rearing during August (Table \@ref(tab:chnk-juv-map), Figure \@ref(fig:chnk-juv-map)). An additional 14.0 rkm is estimated to exceed optimum temperatures by mid-century and an additional 2.8 rkm by late-century. Likewise, 36.0 rkm is estimated to exceed maximum thresholds for Chinook salmon juvenile rearing under recent conditions and is expected to increase in future climate warming scenarios. Currently, none of the Upper Walla watershed is estimated to exceed acute thresholds; however, 8.4 rkm is anticipated to exceed acute thresholds by mid-century and 24.6 rkm by late-century (Table \@ref(tab:chnk-juv-map), Figure \@ref(fig:chnk-juv-map)).

```{r chnk-juv-map, fig.cap = "Maps depicting where modeled August mean stream temperatures exceed optimum, maximum, and acute temperature thresholds for Chinook salmon juvenile, summer rearing within the StreamNet spatial distribution of Chinook salmon in the Upper Walla Walla watershed. Three NorWeST scenarios are shown including a *Recent Historic* composite and two climate warming scenarios, including mid-century (2040) and late-century (2080) predictions. The *Recent Historic* scenario depicts where summer stream temperatures are currently estimated to exceed thresholds whereas the 2040 and 2080 scenarios depict where temperature exceedances are estimated to expand (*New Yes*)."}
results_tbl %>%
  filter(`Life Stage` == "Chinook Parr") %>%
  select(-`Within Optimum`) %>%
  kable(booktabs = T,
        align = "cccccc",
        caption = "The length (km) of stream that falls above optimum, maximum, and acute temperature thresholds for Chinook salmon juvenile, summer rearing within the Chinook salmon spatial domain defined by StreamNet, and for each NorWeST stream temperature scenario evaluated.") %>%
  kable_styling(full_width = F,
                position = "center",
                bootstrap_options = c("striped", "condensed"))

chnk_juv_df = temp_tbl %>%
  filter(chnk == T,
         spec_ls == "Chinook Parr",
         thresh != "Within Optimum",
         scenario != "Recent Minus 1") %>%
  select(spec_ls,
         scenario,
         temp_c,
         geometry) %>%
  distinct() %>%
  mutate(Optimum = ifelse(temp_c > 16, "New Yes", "No"),
         Maximum = ifelse(temp_c > 19, "New Yes", "No"),
         Acute = ifelse(temp_c > 22, "New Yes", "No")) %>%
  st_as_sf() %>%
  mutate(geom_text = as.character(st_geometry(.))) %>%
  group_by(geom_text) %>%
  mutate(Optimum = case_when(
    lag(Optimum) == "New Yes" ~ "Yes",
    is.na(lead(Optimum)) ~ Optimum,
    scenario == "Recent Historic" & Optimum == "New Yes" ~ "Yes",
    TRUE ~ Optimum
  )) %>%
  mutate(Maximum = case_when(
    lag(Maximum) == "New Yes" ~ "Yes",
    is.na(lead(Maximum)) ~ Maximum,
    scenario == "Recent Historic" & Maximum == "New Yes" ~ "Yes",
    TRUE ~ Maximum
  )) %>%
  mutate(Acute = case_when(
    lag(Acute) == "New Yes" ~ "Yes",
    is.na(lead(Acute)) ~ Acute,
    scenario == "Recent Historic" & Acute == "New Yes" ~ "Yes",
    TRUE ~ Acute
  )) %>%
  select(-geom_text) %>%
  pivot_longer(cols = c("Optimum",
                        "Maximum",
                        "Acute"),
               names_to = "thresh") %>%
  mutate(thresh = factor(thresh, levels = c("Optimum",
                                            "Maximum",
                                            "Acute")))

chnk_juv_p = chnk_juv_df %>%
  ggplot() +
  geom_sf(data = chnk_juv_df %>%
            st_union(),
          fill = NA,
          color = "gray70",
          size = 0.7) +
  geom_sf(data = chnk_juv_df,
          aes(color = value),
          size = 0.7) +
  scale_color_manual(values = c("Yes" = "mediumblue",
                                "New Yes" = "orangered",
                                "No" = river_color)) +
  facet_grid(thresh ~ scenario) +
  theme_bw() +
  theme(legend.position = "top",
        axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks = element_blank(),
        panel.grid.major = element_line(color = "transparent")) +
  labs(color = "Above Threshold")
chnk_juv_p

```

### Steelhead Parr

Under the "Recent Historic" scenario, 77.5 rkm of the Upper Walla Walla watershed is estimated to exceed optimum temperatures for steelhead juvenile rearing during August (Table \@ref(tab:sthd-juv-map), Figure \@ref(fig:sthd-juv-map)). An additional 64.0 rkm is estimated to exceed optimum temperatures by mid-century and an additional 32.1 rkm by late-century. Similar, 42.5 rkm is estimated to exceed maximum thresholds for steelhead juvenile rearing under recent conditions and is expected to increase in future climate warming scenarios. Currently, none of the Upper Walla Walla watershed is estimated to exceed acute thresholds; however, 8.6 rkm is anticipated to exceed acute thresholds by mid-century and 24.6 rkm by late-century (Table \@ref(tab:sthd-juv-map), Figure \@ref(fig:sthd-juv-map)).

```{r sthd-juv-map, fig.cap = "Maps depicting where modeled August mean stream temperatures exceed optimum, maximum, and acute temperature thresholds for steelhead juvenile, summer rearing within the StreamNet spatial distribution of steelhead in the Upper Walla Walla watershed. Three NorWeST scenarios are shown including a *Recent Historic* composite and two climate warming scenarios, including mid-century (2040) and late-century (2080) predictions. The *Recent Historic* scenario depicts where summer stream temperatures are currently estimated to exceed thresholds whereas the 2040 and 2080 scenarios depict where temperature exceedances are estimated to expand (*New Yes*)."}
results_tbl %>%
  filter(`Life Stage` == "Steelhead Parr") %>%
  select(-`Within Optimum`) %>%
  kable(booktabs = T,
        align = "cccccc",
        caption = "The length (km) of stream that falls above optimum, maximum, and acute temperature thresholds for steelhead juvenile, summer rearing within the steelhead domain defined by StreamNet, and for each NorWeST stream temperature scenario evaluated.") %>%
  kable_styling(full_width = F,
                position = "center",
                bootstrap_options = c("striped", "condensed"))

sthd_juv_df = temp_tbl %>%
  filter(sthd == T,
         spec_ls == "Steelhead Parr",
         thresh != "Within Optimum",
         scenario != "Recent Minus 1") %>%
  select(spec_ls,
         scenario,
         temp_c,
         geometry) %>%
  distinct() %>%
  mutate(Optimum = ifelse(temp_c > 18, "New Yes", "No"),
         Maximum = ifelse(temp_c > 19, "New Yes", "No"),
         Acute = ifelse(temp_c > 22, "New Yes", "No")) %>%
  st_as_sf() %>%
  mutate(geom_text = as.character(st_geometry(.))) %>%
  group_by(geom_text) %>%
  mutate(Optimum = case_when(
    lag(Optimum) == "New Yes" ~ "Yes",
    is.na(lead(Optimum)) ~ Optimum,
    scenario == "Recent Historic" & Optimum == "New Yes" ~ "Yes",
    TRUE ~ Optimum
  )) %>%
  mutate(Maximum = case_when(
    lag(Maximum) == "New Yes" ~ "Yes",
    is.na(lead(Maximum)) ~ Maximum,
    scenario == "Recent Historic" & Maximum == "New Yes" ~ "Yes",
    TRUE ~ Maximum
  )) %>%
  mutate(Acute = case_when(
    lag(Acute) == "New Yes" ~ "Yes",
    is.na(lead(Acute)) ~ Acute,
    scenario == "Recent Historic" & Acute == "New Yes" ~ "Yes",
    TRUE ~ Acute
  )) %>%
  select(-geom_text) %>%
  pivot_longer(cols = c("Optimum",
                        "Maximum",
                        "Acute"),
               names_to = "thresh") %>%
  mutate(thresh = factor(thresh, levels = c("Optimum",
                                            "Maximum",
                                            "Acute")))

sthd_juv_p = sthd_juv_df %>%
  ggplot() +
  geom_sf(data = sthd_juv_df %>%
            st_union(),
          fill = NA,
          color = "gray70",
          size = 0.7) +
  geom_sf(data = sthd_juv_df,
          aes(color = value),
          size = 0.7) +
  scale_color_manual(values = c("Yes" = "mediumblue",
                                "New Yes" = "orangered",
                                "No" = river_color)) +
  facet_grid(thresh ~ scenario) +
  theme_bw() +
  theme(legend.position = "top",
        axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks = element_blank(),
        panel.grid.major = element_line(color = "transparent")) +
  labs(color = "Above Threshold")
sthd_juv_p

```

### Bull Trout

Under the "Recent Historic" scenario, 98.4 rkm of the Upper Walla Walla watershed is estimated to exceed optimum temperatures for bull trout during August (Table \@ref(tab:bull-map), Figure \@ref(fig:bull-map)). An additional 17.4 rkm is estimated to exceed optimum temperatures by mid-century and an additional 6.4 rkm by late-century. Likewise, 59.8 rkm and 13.4 rkm are estimated to exceed maximum and acute temperature thresholds for bull trout, respectively, under recent conditions, and both are anticipated to increase in future climate warming scenarios (Table \@ref(tab:bull-map), Figure \@ref(fig:bull-map)).

```{r bull-map, fig.cap = "Maps depicting where modeled August mean stream temperatures exceed optimum, maximum, and acute temperature thresholds for bull trout within the StreamNet spatial distribution of bull trout in the Upper Walla Walla watershed. Three NorWeST scenarios are shown including a *Recent Historic* composite and two climate warming scenarios, including mid-century (2040) and late-century (2080) predictions. The *Recent Historic* scenario depicts where summer stream temperatures are currently estimated to exceed thresholds whereas the 2040 and 2080 scenarios depict where temperature exceedances are estimated to expand (*New Yes*)."}
results_tbl %>%
  filter(`Life Stage` == "Bull Trout") %>%
  select(-`Within Optimum`) %>%
  kable(booktabs = T,
        align = "cccccc",
        caption = "The length (km) of stream that falls above optimum, maximum, and acute temperature thresholds for bull trout within the bull trout spatial domain defined by StreamNet, and for each NorWeST stream temperature scenario evaluated.") %>%
  kable_styling(full_width = F,
                position = "center",
                bootstrap_options = c("striped", "condensed"))

bull_df = temp_tbl %>%
  filter(bull == T,
         spec_ls == "Bull Trout",
         thresh != "Within Optimum",
         scenario != "Recent Minus 1") %>%
  select(spec_ls,
         scenario,
         temp_c,
         geometry) %>%
  distinct() %>%
  mutate(Optimum = ifelse(temp_c > 16, "New Yes", "No"),
         Maximum = ifelse(temp_c > 18, "New Yes", "No"),
         Acute = ifelse(temp_c > 20, "New Yes", "No")) %>%
  st_as_sf() %>%
  mutate(geom_text = as.character(st_geometry(.))) %>%
  group_by(geom_text) %>%
  mutate(Optimum = case_when(
    lag(Optimum) == "New Yes" ~ "Yes",
    is.na(lead(Optimum)) ~ Optimum,
    scenario == "Recent Historic" & Optimum == "New Yes" ~ "Yes",
    TRUE ~ Optimum
  )) %>%
  mutate(Maximum = case_when(
    lag(Maximum) == "New Yes" ~ "Yes",
    is.na(lead(Maximum)) ~ Maximum,
    scenario == "Recent Historic" & Maximum == "New Yes" ~ "Yes",
    TRUE ~ Maximum
  )) %>%
  mutate(Acute = case_when(
    lag(Acute) == "New Yes" ~ "Yes",
    is.na(lead(Acute)) ~ Acute,
    scenario == "Recent Historic" & Acute == "New Yes" ~ "Yes",
    TRUE ~ Acute
  )) %>%
  select(-geom_text) %>%
  pivot_longer(cols = c("Optimum",
                        "Maximum",
                        "Acute"),
               names_to = "thresh") %>%
  mutate(thresh = factor(thresh, levels = c("Optimum",
                                            "Maximum",
                                            "Acute")))

bull_p = bull_df %>%
  ggplot() +
  geom_sf(data = bull_df %>%
            st_union(),
          fill = NA,
          color = "gray70",
          size = 0.7) +
  geom_sf(data = bull_df,
          aes(color = value),
          size = 0.7) +
  scale_color_manual(values = c("Yes" = "mediumblue",
                                "New Yes" = "orangered",
                                "No" = river_color)) +
  facet_grid(thresh ~ scenario) +
  theme_bw() +
  theme(legend.position = "top",
        axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks = element_blank(),
        panel.grid.major = element_line(color = "transparent")) +
  labs(color = "Above Threshold")
bull_p

```

### Pacific Lamprey

For lamprey, we considered the entirety of the Upper Walla Walla watershed modeled and available from the NorWeST database; and thus, much of the area considered may not be suitable habitat for Pacific lamprey. However, results still demonstrate areas in lower reaches of the watershed that may exceed optimum, maximum, and acute temperature thresholds for Pacific lamprey (Figure \@ref(fig:lamp-map)). Under the "Recent Historic" scenario, 181.1 rkm of the Upper Walla Walla watershed is extimated to exceed optimum temperature thresholds for Pacific lamprey during August (Table \@ref(tab:lamp-map), Figure \@ref(fig:lamp-map)). An additional, 100.8 rkm is estimated to exceed optimum temperatures by mid-century and an additional 47.7 rkm by late-century. Likewise, 14.4 rkm is estimated to exceed maximum threshold for Pacific lamprey under recent conditions and is expected to increase in future climate warming scenarios. No reaches are anticipated to exceed the acute temperature threshold (25^o^C) for Pacific lamprey under any scenario considered (Table \@ref(tab:lamp-map), Figure \@ref(fig:lamp-map)).

```{r lamp-map, fig.cap = "Maps depicting where modeled August mean stream temperatures exceed optimum, maximum, and acute temperature thresholds for Pacific lamprey within the StreamNet spatial distribution of Pacific lamprey in the Upper Walla Walla watershed. Three NorWeST scenarios are shown including a *Recent Historic* composite and two climate warming scenarios, including mid-century (2040) and late-century (2080) predictions. The *Recent Historic* scenario depicts where summer stream temperatures are currently estimated to exceed thresholds whereas the 2040 and 2080 scenarios depict where temperature exceedances are estimated to expand (*New Yes*)."}
results_tbl %>%
  filter(`Life Stage` == "Pacific Lamprey") %>%
  select(-`Within Optimum`) %>%
  kable(booktabs = T,
        align = "cccccc",
        caption = "The length (km) of stream that falls above optimum, maximum, and acute temperature thresholds for Pacific lamprey within the Pacific lamprey spatial domain defined by StreamNet, and for each NorWeST stream temperature scenario evaluated.") %>%
  kable_styling(full_width = F,
                position = "center",
                bootstrap_options = c("striped", "condensed"))

lamp_df = temp_tbl %>%
  filter(lamp == T,
         spec_ls == "Pacific Lamprey",
         thresh != "Within Optimum",
         scenario != "Recent Minus 1") %>%
  select(spec_ls,
         scenario,
         temp_c,
         geometry) %>%
  distinct() %>%
  mutate(Optimum = ifelse(temp_c > 17, "New Yes", "No"),
         Maximum = ifelse(temp_c > 20, "New Yes", "No"),
         Acute = ifelse(temp_c > 25, "New Yes", "No")) %>%
  st_as_sf() %>%
  mutate(geom_text = as.character(st_geometry(.))) %>%
  group_by(geom_text) %>%
  mutate(Optimum = case_when(
    lag(Optimum) == "New Yes" ~ "Yes",
    is.na(lead(Optimum)) ~ Optimum,
    scenario == "Recent Historic" & Optimum == "New Yes" ~ "Yes",
    TRUE ~ Optimum
  )) %>%
  mutate(Maximum = case_when(
    lag(Maximum) == "New Yes" ~ "Yes",
    is.na(lead(Maximum)) ~ Maximum,
    scenario == "Recent Historic" & Maximum == "New Yes" ~ "Yes",
    TRUE ~ Maximum
  )) %>%
  mutate(Acute = case_when(
    lag(Acute) == "New Yes" ~ "Yes",
    is.na(lead(Acute)) ~ Acute,
    scenario == "Recent Historic" & Acute == "New Yes" ~ "Yes",
    TRUE ~ Acute
  )) %>%
  select(-geom_text) %>%
  pivot_longer(cols = c("Optimum",
                        "Maximum",
                        "Acute"),
               names_to = "thresh") %>%
  mutate(thresh = factor(thresh, levels = c("Optimum",
                                            "Maximum",
                                            "Acute")))

lamp_p = lamp_df %>%
  ggplot() +
  geom_sf(data = lamp_df %>%
            st_union(),
          fill = NA,
          color = "gray70",
          size = 0.7) +
  geom_sf(data = lamp_df,
          aes(color = value),
          size = 0.7) +
  scale_color_manual(values = c("Yes" = "mediumblue",
                                "New Yes" = "orangered",
                                "No" = river_color)) +
  facet_grid(thresh ~ scenario) +
  theme_bw() +
  theme(legend.position = "top",
        axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks = element_blank(),
        panel.grid.major = element_line(color = "transparent")) +
  labs(color = "Above Threshold")
lamp_p

```

## Theoretical Cooling Scenario

Predictably, the hypothetical scenario where summer stream temperatures were decreased by 1^o^C relative to the recent historic composite mean reduced the stream length that exceeded optimum and maximum temperature thresholds for all focal species and life stages evaluated (Table \@ref(tab:cool)). There were no stream reaches above acute temperature thresholds for Chinook parr, steelhead parr, and Pacific lamprey under recent composite conditions, and thus, no additional reaches were "gained" (Table \@ref(tab:cool)). As an example, if stream temperatures were reduced by 1^o^C relative to current conditions, an additional 35.0 rkm of stream would fall within optimum temperature ranges for steelhead summer parr rearing and an additional 28.1 km would become below maximum temperature thresholds. Table \@ref(tab:cool) shows the amount of stream that would be "gained" i.e., fall below thresholds under the theoretical -1^o^C cooling scenario for each species and life stage.

```{r cool}
temp_tbl %>%
  select(spec_ls,
         scenario,
         thresh,
         reach_leng,
         in_thresh) %>%
  filter(scenario %in% c("Recent Minus 1", "Recent Historic"),
         thresh != "Within Optimum",
         in_thresh == T) %>%
  group_by(spec_ls,
           scenario,
           thresh) %>%
  summarize(length_km = round(sum(reach_leng) / 1000, 1)) %>%
  pivot_wider(names_from = scenario,
              values_from = length_km) %>%
  mutate(gain_km = `Recent Historic` - `Recent Minus 1`) %>%
  select(-`Recent Historic`,
         -`Recent Minus 1`) %>%
  pivot_wider(names_from = thresh,
              values_from = gain_km) %>%
  select(`Life Stage` = spec_ls,
         `Below Optimum` = `Above Optimum`,
         `Below Maximum` = `Above Maximum`,
         `Below Acute` = `Above Acute`) %>%
  arrange(match(`Life Stage`, c("Chinook Spawning", 
                                "Chinook Parr", 
                                "Steelhead Parr", 
                                "Bull Trout", 
                                "Pacific Lamprey"))) %>%
  kable(booktabs = T,
        align = "cccc",
        caption = "The estimated length (km) of stream in the Upper Walla Walla watershed that would be gained i.e., fall below optimum, maximum, and acute temperature thresholds under a theoretical -1^o^C cooling scenario relative to recent composite (2002 - 2011) conditions.") %>%
  kable_styling(full_width = F,
                position = "center",
                bootstrap_options = c("striped", "condensed"))

```

## Geomorphic Reaches

Three of the five geomorphic reaches in the mainstem Walla Walla River and two of eight in the North Fork Walla Walla River were estimated to have $\geq$50% of the stream length exceed optimum temperature thresholds, averaged among species and life stages (Table \@ref(tab:geo-results)), and each were listed as "High" priority. Two additional geomorphic reaches within each of the mainstem and North Fork Walla Walla rivers were listed as "Medium" priority. Only one geomorphic reach in the South Fork Walla Walla River was listed as "Medium" priority as 4.6% of the stream length exceeded optimum temperatures for Chinook salmon spawning; the remaining reaches in the South Fork Walla Walla were all listed as "Low" priority. Figure \@ref(fig:geo-plot) also shows the percentage of each reach, by length, that exceeds optimum, maximum, and acute temperature thresholds for each species and life stage under the recent composite scenario. Every geomorphic reach in the mainstem Walla Walla (WW1 - WW5) had extents that exceeded optimum temperatures for every species by life stage considered and three of five (WW1, WW2, WW4) had reaches exceeding maximum thresholds. Some lower reaches in the North Fork Walla Walla River (NF1 - NF3) are also of concern with some extents exceeding optimum thresholds and one reach (NF1) containing reaches that exceed maximum temperatures for Chinook salmon spawning. Only one geomorphic reach in the South Fork Walla Walla (SF1) had some portion (4.6%) exceeding Chinook salmon optimum thresholds; otherwise, the South Fork Walla Walla is of little concern for exceeding temperature thresholds, at least under the recent composite scenario. 

```{r geo-results}
geo_order = c("WW1", "WW2", "WW3", "WW4", "WW5",
              "NF1", "NF2", "NF3", "NF4", "NF5", "NF6", "NF7", "NF8",
              "SF1", "SF2", "SF3", "SF4", "SF5", "SF6", "SF7", "SF8")

geo_df = uww_rch_sf_w_geos %>%
  select(Geo_Reach,
         reach_leng,
         `temp_c` = S2_02_11) %>%
  drop_na(Geo_Reach) %>%
  mutate(Geo_Reach = factor(Geo_Reach, levels = geo_order)) %>%
  expand_grid(spec_ls, thresh) %>%
  mutate(in_thresh = case_when(
    spec_ls == "Chinook Spawning" & thresh == "Within Optimum" & temp_c >= 7.2 & temp_c <= 14.5 ~ T,
    spec_ls == "Chinook Spawning" & thresh == "Above Optimum"  & temp_c >  14.5 ~ T,
    spec_ls == "Chinook Spawning" & thresh == "Above Maximum"  & temp_c >  17.7 ~ T,
    spec_ls == "Chinook Spawning" & thresh == "Above Acute"    & temp_c >  20 ~ T,
    spec_ls == "Chinook Parr"     & thresh == "Within Optimum" & temp_c >= 10 & temp_c <= 16 ~ T,
    spec_ls == "Chinook Parr"     & thresh == "Above Optimum"  & temp_c >  16 ~ T,
    spec_ls == "Chinook Parr"     & thresh == "Above Maximum"  & temp_c >  19 ~ T,
    spec_ls == "Chinook Parr"     & thresh == "Above Acute"    & temp_c >  22 ~ T,
    spec_ls == "Steelhead Parr"   & thresh == "Within Optimum" & temp_c >= 10 & temp_c <= 18 ~ T,
    spec_ls == "Steelhead Parr"   & thresh == "Above Optimum"  & temp_c >  18 ~ T,
    spec_ls == "Steelhead Parr"   & thresh == "Above Maximum"  & temp_c >  19 ~ T,
    spec_ls == "Steelhead Parr"   & thresh == "Above Acute"    & temp_c >  22 ~ T,
    spec_ls == "Bull Trout"       & thresh == "Within Optimum" & temp_c >= 10.2 & temp_c <= 16 ~ T,
    spec_ls == "Bull Trout"       & thresh == "Above Optimum"  & temp_c >  16 ~ T,
    spec_ls == "Bull Trout"       & thresh == "Above Maximum"  & temp_c >  18 ~ T,
    spec_ls == "Bull Trout"       & thresh == "Above Acute"    & temp_c >  20 ~ T,
    spec_ls == "Pacific Lamprey"  & thresh == "Within Optimum" & temp_c >= 10 & temp_c <= 17 ~ T,
    spec_ls == "Pacific Lamprey"  & thresh == "Above Optimum"  & temp_c >  17 ~ T,
    spec_ls == "Pacific Lamprey"  & thresh == "Above Maximum"  & temp_c >  20 ~ T,
    spec_ls == "Pacific Lamprey"  & thresh == "Above Acute"    & temp_c >  25 ~ T,
    TRUE ~ F ))

abv_opt_geo = geo_df %>%
  filter(thresh == "Above Optimum") %>%
  pivot_wider(names_from = spec_ls,
              values_from = in_thresh) %>%
  group_by(Geo_Reach) %>%
  summarize(min_temp_c = round(min(temp_c), 1),
            mean_temp_c = round(mean(temp_c), 1),
            max_temp_c = round(max(temp_c), 1),
            length_km = round(sum(reach_leng) / 1000, 1),
            chn_spw = round(sum(reach_leng[`Chinook Spawning` == T]) / sum(reach_leng) * 100, 1),
            chn_juv = round(sum(reach_leng[`Chinook Parr` == T]) / sum(reach_leng) * 100, 1),
            sth_juv = round(sum(reach_leng[`Steelhead Parr` == T]) / sum(reach_leng) * 100, 1),
            bull = round(sum(reach_leng[`Bull Trout` == T]) / sum(reach_leng) * 100, 1),
            lamp = round(sum(reach_leng[`Pacific Lamprey` == T]) / sum(reach_leng) * 100, 1)) %>%
  rowwise() %>%
  mutate(mean = round(mean(c_across(c("chn_spw", "chn_juv", "sth_juv", "bull", "lamp"))), 1)) %>%
  mutate(Priority = case_when(
    mean == 0 ~ "Low",
    between(mean, 0, 50) ~ "Medium",
    mean > 50 ~ "High"
  )) %>%
  select(Reach = Geo_Reach,
         Min = min_temp_c,
         Mean = mean_temp_c,
         Max = max_temp_c,
         `Length (km)` = length_km,
         `Chinook Spawning (%)` = chn_spw,
         `Chinook Parr (%)` = chn_juv,
         `Steelhead Parr (%)` = sth_juv,
         `Bull Trout (%)` = bull,
         `Pacific Lamprey (%)` = lamp,
         `Species Mean (%)` = mean,
         Priority)

abv_opt_geo %>%
  kable(booktabs = T,
        align = "cccccccccccc",
        caption = "The minimum, maximum, and mean August mean stream temperatures (^o^C) and length (km) for each geomorphic reach and the percentage by length of each reach that falls above the optimum temperature threshold for each species and life stage and using the recent historic temperature scenario.") %>%
  kable_styling(full_width = F,
                position = "center",
                bootstrap_options = c("striped", "condensed"))

```

```{r geo-plot, fig.height = 7, fig.cap = "The percentage of each geomorphic reach, by length, that exceeds optimum, maximum, and acute temperature thresholds for each species x life stage and under the recent composite (2002-2011) scenario."}
geo_p_df = geo_df %>%
  filter(thresh != "Within Optimum") %>%
  pivot_wider(names_from = spec_ls,
              values_from = in_thresh) %>%
  group_by(Geo_Reach) %>%
  summarize(length_km = round(sum(reach_leng) / 1000, 1),
            chsp_opt = round(sum(reach_leng[`Chinook Spawning` == T & thresh == "Above Optimum"]) / sum(reach_leng[thresh == "Above Optimum"]) * 100, 1),
            chsp_max = round(sum(reach_leng[`Chinook Spawning` == T & thresh == "Above Maximum"]) / sum(reach_leng[thresh == "Above Maximum"]) * 100, 1),
            chsp_acu = round(sum(reach_leng[`Chinook Spawning` == T & thresh == "Above Acute"]) / sum(reach_leng[thresh == "Above Acute"]) * 100, 1),
            chjv_opt = round(sum(reach_leng[`Chinook Parr` == T & thresh == "Above Optimum"]) / sum(reach_leng[thresh == "Above Optimum"]) * 100, 1),
            chjv_max = round(sum(reach_leng[`Chinook Parr` == T & thresh == "Above Maximum"]) / sum(reach_leng[thresh == "Above Maximum"]) * 100, 1),
            chjv_acu = round(sum(reach_leng[`Chinook Parr` == T & thresh == "Above Acute"]) / sum(reach_leng[thresh == "Above Acute"]) * 100, 1),
            sthd_opt = round(sum(reach_leng[`Steelhead Parr` == T & thresh == "Above Optimum"]) / sum(reach_leng[thresh == "Above Optimum"]) * 100, 1),
            sthd_max = round(sum(reach_leng[`Steelhead Parr` == T & thresh == "Above Maximum"]) / sum(reach_leng[thresh == "Above Maximum"]) * 100, 1),
            sthd_acu = round(sum(reach_leng[`Steelhead Parr` == T & thresh == "Above Acute"]) / sum(reach_leng[thresh == "Above Acute"]) * 100, 1),
            bull_opt = round(sum(reach_leng[`Bull Trout` == T & thresh == "Above Optimum"]) / sum(reach_leng[thresh == "Above Optimum"]) * 100, 1),
            bull_max = round(sum(reach_leng[`Bull Trout` == T & thresh == "Above Maximum"]) / sum(reach_leng[thresh == "Above Maximum"]) * 100, 1),
            bull_acu = round(sum(reach_leng[`Bull Trout` == T & thresh == "Above Acute"]) / sum(reach_leng[thresh == "Above Acute"]) * 100, 1),
            lamp_opt = round(sum(reach_leng[`Pacific Lamprey` == T & thresh == "Above Optimum"]) / sum(reach_leng[thresh == "Above Optimum"]) * 100, 1),
            lamp_max = round(sum(reach_leng[`Pacific Lamprey` == T & thresh == "Above Maximum"]) / sum(reach_leng[thresh == "Above Maximum"]) * 100, 1),
            lamp_acu = round(sum(reach_leng[`Pacific Lamprey` == T & thresh == "Above Acute"]) / sum(reach_leng[thresh == "Above Acute"]) * 100, 1)) %>%
  pivot_longer(cols = chsp_opt:lamp_acu,
               names_to = "case",
               values_to = "Percent") %>%
  mutate(spec_ls = str_sub(case, 1, 4),
         scenario = str_sub(case, -3)) %>%
  mutate(spec_ls = recode(spec_ls,
                          "chsp" = "Chinook Spawning",
                          "chjv" = "Chinook Parr",
                          "sthd" = "Steelhead Parr",
                          "bull" = "Bull Trout",
                          "lamp" = "Pacific Lamprey")) %>%
  mutate(scenario = recode(scenario,
                           "opt" = "Optimum",
                           "max" = "Maximum",
                           "acu" = "Acute")) %>%
  select(Reach = Geo_Reach,
         `Species & Life Stage` = spec_ls,
         Threshold = scenario,
         `Length (km)` = length_km,
         Percent) %>%
  mutate(`Species & Life Stage` = factor(`Species & Life Stage`, levels = c("Chinook Spawning",
                                                                            "Chinook Parr",
                                                                            "Steelhead Parr",
                                                                            "Bull Trout",
                                                                            "Pacific Lamprey"))) %>%
  mutate(Threshold = factor(Threshold, levels = c("Optimum",
                                                  "Maximum",
                                                  "Acute")))
    
geo_p_df %>%
  ggplot(aes(x = Reach,
             y = Percent,
             fill = Threshold)) +
  geom_col(color = "black",
           position = position_dodge()) +
  ylim(0, 100) +
  #geom_bar(stat = "identity") +
  facet_wrap(~ `Species & Life Stage`, ncol = 1) +
  theme_bw() +
  theme(legend.position = "top",
        axis.text.x = element_text(angle = 45,
                                   vjust = 0.5))

```

All results and spatial data are available within the GitHub repository located at <https://github.com/Mount-Hood-Environmental/UWW.plan> and can be exported for viewing in GIS software.


# Discussion

In most cases, a greater portion of the Upper Walla Walla watershed fell outside of optimum temperature ranges for each species and life stage considered when moving from the recent historic to projected mid- and late-century climate warming scenarios (Table \@ref(tab:within-optimum-tbl), Figure \ref(fig:within-optimum-map)). Moreover, a greater portion of stream length exceeded optimum, maximum, and acute temperature thresholds transitioning into future climate warming scenarios (Figures \@ref(fig:chnk-spw-map) - \@ref(fig:lamp-map), Tables \@ref(tab:chnk-spw-map) - \@ref(tab:lamp-map)). The single exception was for Pacific lamprey where stream temperatures didn't exceed their acute threshold of 25^o^C under any scenario. The evaluation of recent historic (2002 - 2011) August stream temperatures estimated that greater than 21% of each species' domain within the Upper Walla Walla watershed exceeds optimum temperatures, and that value increased to 33% and 38% under projected 2040 and 2080 climate warming scenarios, respectively. Chinook salmon spawning, which typically occurs mid-August to mid-September for spring-run Chinook salmon in the Snake River basin, was of greatest concern. We estimated that 83.5 rkm, 65.2% of their domain, currently exceeds optimum temperatures for Chinook salmon spawning; that value increased to 87.3 rkm (68.1%) and 96.6 rkm (75.4%) under the 2040 and 2080 warming scenarios, respectively.

In some cases, the amount of stream habitat that fell within optimum temperature ranges actually increased when going from recent historic to 2040 or from 2040 to 2080 scenarios (Table \@ref(tab:within-optimum-tbl)), including for Chinook salmon parr, bull trout, and Pacific lamprey. This observation results from upstream (headwater) reaches warming to be within optimum ranges at a higher rate than downstream reaches warming to exceed minimum optimum ranges, and related, that the number of warming upstream smaller tributaries often exceeds the number of warming downstream "mainstems". However, this result can be misleading misleading especially in cases where the cooler headwater reaches are inaccessible either due to partial or full and manmade or partial barriers, including temperature barriers resulting from downstream reaches being too warm. Further, even though temperature ranges might improve (i.e., warm slightly) in headwater reaches in future scenarios, practical habitat suitability for upper reaches is likely somewhat overstated due to small tributary sizes, low flows, etc. The loss of thermally suitable habitats in the lower reaches of the watershed are of greatest concern.

All geomorphic reaches in the mainstem Walla Walla River (WW1 - WW5) are estimated to have at least 25% of their stream length exceed optimum temperature thresholds averaged across species and life stages; moreover, 100% of geomorphic reach WW1 currently exceeds optimum temperatures for all species and life stages (Table \@ref(tab:geo-results)). All geomorphic reaches in the mainstem Walla Walla River were listed as "Medium" and "High" priority for actions to mediate or reduce summer stream temperatures. An additional two geomorphic reaches in the North Fork Walla Walla were also listed as "High" priority. The results of this assessment highlight the imporance of conducting restoration projects in the middle and lower reaches of the Upper Walla Walla watershed that exceed optimum, maximum, and acute temperature thresholds for focal species. Actions to reduce peak summer water temperatures, such as riparian restoration, improved grazing practices, and channel narrowing should be considered in the Upper Walla Walla watershed, particularly in reaches identified in Figures \@ref(fig:chnk-spw-map) - \@ref(fig:lamp-map) and/or Table \@ref(tab:geo-results) and Figure \@ref(fig:geo-plot). @Justice2017 similarly evaluated a 2080s climate change scenario and demonstrated that despite substantial increases in summer stream temperatures, basin-wide restoration of riparian vegetation and channel width could offset climate impacts in the Upper Grande Ronde and Catherine Creek watersheds in eastern Oregon. We recognize that the -1^o^C scenario is unrealistic, but illustrative of how restoration actions throughout the watershed could help mitigate the impacts of a warming climate.


# Literature Cited

<!-- The following line ensures the references appear here for the MS Word or HTML output files, rather than right at the end of the document (this will not work for PDF files):  -->

::: {#refs}
:::

```{r write-spatial, eval = F}
chnk_spw_recent = temp_tbl %>%
  select(spec_ls,
         scenario,
         in_domain = chnk,
         reach_leng,
         temp_c,
         thresh,
         in_thresh,
         geometry) %>%
  filter(scenario == "Recent Historic",
         spec_ls == "Chinook Spawning") %>%
  pivot_wider(names_from = "thresh",
              values_from = "in_thresh")

chnk_spw_2040 = temp_tbl %>%
  select(spec_ls,
         scenario,
         in_domain = chnk,
         reach_leng,
         temp_c,
         thresh,
         in_thresh,
         geometry) %>%
  filter(scenario == "2040 Projected",
         spec_ls == "Chinook Spawning") %>%
  pivot_wider(names_from = "thresh",
              values_from = "in_thresh")
chnk_spw_2080 = temp_tbl %>%
  select(spec_ls,
         scenario,
         in_domain = chnk,
         reach_leng,
         temp_c,
         thresh,
         in_thresh,
         geometry) %>%
  filter(scenario == "2080 Projected",
         spec_ls == "Chinook Spawning") %>%
  pivot_wider(names_from = "thresh",
              values_from = "in_thresh")

chnk_juv_recent = temp_tbl %>%
  select(spec_ls,
         scenario,
         in_domain = chnk,
         reach_leng,
         temp_c,
         thresh,
         in_thresh,
         geometry) %>%
  filter(scenario == "Recent Historic",
         spec_ls == "Chinook Parr") %>%
  pivot_wider(names_from = "thresh",
              values_from = "in_thresh")

chnk_juv_2040 = temp_tbl %>%
  select(spec_ls,
         scenario,
         in_domain = chnk,
         reach_leng,
         temp_c,
         thresh,
         in_thresh,
         geometry) %>%
  filter(scenario == "2040 Projected",
         spec_ls == "Chinook Parr") %>%
  pivot_wider(names_from = "thresh",
              values_from = "in_thresh")
chnk_juv_2080 = temp_tbl %>%
  select(spec_ls,
         scenario,
         in_domain = chnk,
         reach_leng,
         temp_c,
         thresh,
         in_thresh,
         geometry) %>%
  filter(scenario == "2080 Projected",
         spec_ls == "Chinook Parr") %>%
  pivot_wider(names_from = "thresh",
              values_from = "in_thresh")

sthd_juv_recent = temp_tbl %>%
  select(spec_ls,
         scenario,
         in_domain = chnk,
         reach_leng,
         temp_c,
         thresh,
         in_thresh,
         geometry) %>%
  filter(scenario == "Recent Historic",
         spec_ls == "Steelhead Parr") %>%
  pivot_wider(names_from = "thresh",
              values_from = "in_thresh")

sthd_juv_2040 = temp_tbl %>%
  select(spec_ls,
         scenario,
         in_domain = chnk,
         reach_leng,
         temp_c,
         thresh,
         in_thresh,
         geometry) %>%
  filter(scenario == "2040 Projected",
         spec_ls == "Steelhead Parr") %>%
  pivot_wider(names_from = "thresh",
              values_from = "in_thresh")
sthd_juv_2080 = temp_tbl %>%
  select(spec_ls,
         scenario,
         in_domain = chnk,
         reach_leng,
         temp_c,
         thresh,
         in_thresh,
         geometry) %>%
  filter(scenario == "2080 Projected",
         spec_ls == "Steelhead Parr") %>%
  pivot_wider(names_from = "thresh",
              values_from = "in_thresh")

bull_recent = temp_tbl %>%
  select(spec_ls,
         scenario,
         in_domain = chnk,
         reach_leng,
         temp_c,
         thresh,
         in_thresh,
         geometry) %>%
  filter(scenario == "Recent Historic",
         spec_ls == "Bull Trout") %>%
  pivot_wider(names_from = "thresh",
              values_from = "in_thresh")

bull_2040 = temp_tbl %>%
  select(spec_ls,
         scenario,
         in_domain = chnk,
         reach_leng,
         temp_c,
         thresh,
         in_thresh,
         geometry) %>%
  filter(scenario == "2040 Projected",
         spec_ls == "Bull Trout") %>%
  pivot_wider(names_from = "thresh",
              values_from = "in_thresh")
bull_2080 = temp_tbl %>%
  select(spec_ls,
         scenario,
         in_domain = chnk,
         reach_leng,
         temp_c,
         thresh,
         in_thresh,
         geometry) %>%
  filter(scenario == "2080 Projected",
         spec_ls == "Bull Trout") %>%
  pivot_wider(names_from = "thresh",
              values_from = "in_thresh")

lamp_recent = temp_tbl %>%
  select(spec_ls,
         scenario,
         in_domain = chnk,
         reach_leng,
         temp_c,
         thresh,
         in_thresh,
         geometry) %>%
  filter(scenario == "Recent Historic",
         spec_ls == "Pacific Lamprey") %>%
  pivot_wider(names_from = "thresh",
              values_from = "in_thresh")

lamp_2040 = temp_tbl %>%
  select(spec_ls,
         scenario,
         in_domain = chnk,
         reach_leng,
         temp_c,
         thresh,
         in_thresh,
         geometry) %>%
  filter(scenario == "2040 Projected",
         spec_ls == "Pacific Lamprey") %>%
  pivot_wider(names_from = "thresh",
              values_from = "in_thresh")
lamp_2080 = temp_tbl %>%
  select(spec_ls,
         scenario,
         in_domain = chnk,
         reach_leng,
         temp_c,
         thresh,
         in_thresh,
         geometry) %>%
  filter(scenario == "2080 Projected",
         spec_ls == "Pacific Lamprey") %>%
  pivot_wider(names_from = "thresh",
              values_from = "in_thresh")

st_write(chnk_spw_recent, here("analysis/data/derived_data/norwest/uww_stream_temp.gpkg"), "chnk_spw_recent")
st_write(chnk_spw_2040, here("analysis/data/derived_data/norwest/uww_stream_temp.gpkg"), "chnk_spw_2040", append = TRUE)
st_write(chnk_spw_2080, here("analysis/data/derived_data/norwest/uww_stream_temp.gpkg"), "chnk_spw_2080", append = TRUE)
st_write(chnk_juv_recent, here("analysis/data/derived_data/norwest/uww_stream_temp.gpkg"), "chnk_juv_recent", append = TRUE)
st_write(chnk_juv_2040, here("analysis/data/derived_data/norwest/uww_stream_temp.gpkg"), "chnk_juv_2040", append = TRUE)
st_write(chnk_juv_2080, here("analysis/data/derived_data/norwest/uww_stream_temp.gpkg"), "chnk_juv_2080", append = TRUE)
st_write(sthd_juv_recent, here("analysis/data/derived_data/norwest/uww_stream_temp.gpkg"), "sthd_juv_recent", append = TRUE)
st_write(sthd_juv_2040, here("analysis/data/derived_data/norwest/uww_stream_temp.gpkg"), "sthd_juv_2040", append = TRUE)
st_write(sthd_juv_2080, here("analysis/data/derived_data/norwest/uww_stream_temp.gpkg"), "sthd_juv_2080", append = TRUE)
st_write(bull_recent, here("analysis/data/derived_data/norwest/uww_stream_temp.gpkg"), "bull_recent", append = TRUE)
st_write(bull_2040, here("analysis/data/derived_data/norwest/uww_stream_temp.gpkg"), "bull_2040", append = TRUE)
st_write(bull_2080, here("analysis/data/derived_data/norwest/uww_stream_temp.gpkg"), "bull_2080", append = TRUE)
st_write(lamp_recent, here("analysis/data/derived_data/norwest/uww_stream_temp.gpkg"), "lamp_recent", append = TRUE)
st_write(lamp_2040, here("analysis/data/derived_data/norwest/uww_stream_temp.gpkg"), "lamp_2040", append = TRUE)
st_write(lamp_2080, here("analysis/data/derived_data/norwest/uww_stream_temp.gpkg"), "lamp_2080", append = TRUE)

```
