---
title: "Summer Stream Temperature Assessment, Upper Walla Walla Watershed - *PRELIMINARY*"
author:
  - Michael W. Ackerman:
      email: mike.ackerman@mthoodenvironmental.com
      institute: [mhe_mccall]
      correspondence: true
  - Bryce N. Oldemeyer:
      email: bryce.oldemeyer@mthoodenvironmental.com
      institute: [mhe_challis]
      correspondence: true
  - Mark Roes:
      email: mark.roes@mthoodenvironmental.com
      institute: [mhe_sandy]
      correspondence: false
institute:
  - mhe_mccall: Mount Hood Environmental, PO Box 4282, McCall, Idaho, 83638, USA
  - mhe_challis: Mount Hood Environmental, PO Box 1303, Challis, Idaho 83226, USA
  - mhe_sandy: Mount Hood Environmental, 39085 Pioneer Boulevard \#100 Mezzanine, Sandy, Oregon, 97055, USA
date: "`r format(Sys.time(), '%d %B, %Y')`"
output:
  bookdown::html_document2:
    theme: yeti
    toc: yes
    toc_depth: 2
    toc_float:
      collapsed: yes
      smooth_scroll: yes
    number_sections: yes
    pandoc_args:
    - --lua-filter=../templates/scholarly-metadata.lua
    - --lua-filter=../templates/author-info-blocks.lua
    - --lua-filter=../templates/pagebreak.lua  
csl: "../templates/journal-of-archaeological-science.csl"
bibliography:
  - AckermanLibrary.bib
always_allow_html: yes
---

<!-- the following inserts MHE logo into header -->

```{=html}
<script>
   $(document).ready(function() {
     $head = $('#header');
     $head.prepend('<img src=\"logo.jpg\" style=\"float: right;width: 150px;\"/>')
   });
</script>
```
```{r setup, echo = FALSE, message = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  warning = FALSE,
  message = FALSE,
  echo = FALSE,
  comment = "#>",
  fig.path = "../figures/",
  dpi = 600
)

options(knitr.kable.NA = '--')

```

```{r load-libraries}
# run this if running chunks directly

# for formatting
library(kableExtra)
library(ggpubr)

# for analysis
library(sf)
library(here)
library(tidyverse)
library(magrittr)
library(ggmap)
library(nngeo)
library(janitor)

theme_set(theme_pubr(x.text.angle = 45,
                     base_size = 8))

```

```{r load-data}
# Project area polygons and 200m layer (with habitat attributes) within project area
load(here("analysis/data/derived_data/uww_spatial.rda"))

```

# Background

Water is the cornerstone of First Foods production and inherently tied to the five fundamental touchstones: hydrology, geomorphology, habitat and network connectivity, riverine biotic community, and riparian vegetation [@Jones2008]. These touchstones form the Umatilla River Vision, a holistic approach to water quality restoration. Stream temperature is a critical component of the hydrology of the Upper Walla Walla watershed, directly affecting the fish community and the connectivity of their habitat. Warming climatic conditions are expected to have pronounced effects on salmonids [@Kovach2016]. In the Pacific Northwest, summer months are anticipated to become progressively more stressful as stream temperatures increase with warming air temperatures, which is likely to shift and reduce suitable habitat for many species [@Isaak2015; @Jones2014]. Here, we evaluate recent historic and future projected summer stream temperature scenarios [@Isaak2017a] for the Upper Walla Walla watershed and compare them to life-stage specific temperature threshholds for focal species. The goal of this assessment was to determine whether summer stream temperature were a potential factor limiting fish population productivity and to identify if and where restoration actions (e.g., riparian planting, improved grazing practices) aimed at reducing stream temperatures could be considered to help mitigate future impacts of a warming climate.

## Objectives

The primary objectives of the Upper Walla Walla summer stream temperature assessment include:

1.  Summarize recent historic and future projected summer stream temperature scenarios for the Upper Walla Walla available from the [NorWeST](https://www.fs.usda.gov/rm/boise/AWAE/projects/NorWeST.html) database [Isaak2017a].

2.  Compare recent historic and future projected summer stream temperature scenarios in the Upper Walla Walla to life-stage specific temperature thresholds for focal species to determine whether temperatures may hinder summer life-stages of those species.

3.  Evaluate a hypothetical scenario where restoration efforts (e.g. riparian planting, improved grazing practices, etc.) over the next \~60 years decrease summer stream temperatures relative to recent historic temperatures by 1^o^C.

# Methods

Recent historic (2002-2011) and projected (2040 & 2080) August mean stream temperature predictions [@Isaak2017a] were used for the Upper Walla Walla River watershed, in conjunction with life-stage specific temperature thresholds available from the literature for focal species (Table \@ref(tab:temp-thresh)), to evaluate potential habitat limitations. To accomplish this, modeled recent historic and projected August mean stream temperatures were used to quantify the amount of stream habitat exceeding optimum and maximum temperature thresholds for focal species present in the Upper Walla Walla watershed during summer months. Additionally, a scenario where hypothetical restoration actions reduced mean August stream temperatures by 1^o^C relative to recent historic temperatures was evaluated to provide context for the benefits restoration actions could provide for thermal suitability of habitat within the watershed.

## Study Area

The summer stream temperature assessment was focused on the upper Walla Walla River from the confluence with Dry Creek near Lowden, Washington, to the headwaters of the North Fork and South Fork of the Walla Walla River, including tributaries (Table \@ref(tab:study-area)). Rivers and tributaries included in the assessment were modeled as part of the NorWeST regional database [@Isaak2017a].

```{r UWW-NRWST_DIST, out.width = "100%", fig.cap = "Stream extents for the Upper Walla Walla watershed included in the summer stream temperature assessment that are modeled as part of the NorWeST regional database (Isaak et al. 2017). Primary rivers and tributaries utilized by Chinook salmon and steelhead are labeled in the map."}
knitr::include_graphics("../maps/UWW_NorWeST.png")

```

```{r study-area}
study_tab = uww_rch_sf %>%
  select(GNIS_Name, reach_leng, S2_02_11) %>%
  st_drop_geometry() %>%
  filter(!is.na(S2_02_11)) %>%
  group_by(GNIS_Name) %>%
  summarize(`Length (km)` = round(sum(reach_leng) / 1000, 1)) %>%
  rename(`Stream Name` = GNIS_Name) %>%
  adorn_totals() %>%
  mutate(`Stream Name` = ifelse(is.na(`Stream Name`), "Unnamed Creek(s)", `Stream Name`)) %>%
  kable(booktabs = T,
        align = "lc",
        caption = "Rivers and tributaries included in the summer stream temperature assessment that were modeled as part of the NorWeST regional database.") %>%
  kable_styling(full_width = F,
                position = "center",
                bootstrap_options = c("striped", "condensed"))
study_tab

```

## Focal Species

The focal species for the summer stream temperature assessment include:

-   Spring-run Chinook salmon (*Oncorhynchus tshawytscha*; hereafter Chinook salmon)
-   Middle Columbia River summer steelhead (*O. mykiss*; hereafter steelhead; ESA-listed "threatened")
-   Columbia River bull trout (*Salvelinus confluentus*; ESA-listed "threatened")
-   Pacific lamprey (*Lampetra tridentata*)

## Summer Stream Temperature Scenarios

Three NorWeST summer stream temperature scenarios were considered:

-   **Recent Historic** (S2_02_11): A historical composite scenario representing the 10-year average August mean stream temperatures for 2002-2011 (Isaak et al. 2017).

-   **2040 Projected** (S30_2040D): A future August mean stream temperature scenario based on average projected changes in August air temperature and stream discharge for the 2040s (2030-2059). Projected changes in streams accounted for differential sensitivity among streams so that cold streams warm less than warm streams (Isaak et al. 2017).

-   **2080 Projected** (S32_2080D): A future August mean stream temperature scenario based on average projected changes in August air temperature and stream discharge for the 2080s (2070-2099). Projected changes in streams accounted for differential sensitivity among streams so that cold streams warm less than warm streams (Isaak et al. 2017).

In addition, we evaluated a hypothetical scenario (**Recent Minus 1**) where summer stream temperatures were reduced by 1^o^C relative to the recent historic scenario. This scenario represents a hypothetical situation where restoration actions, such as riparian planting or improved grazing practices, increased stream shading, reduced solar loading, and increased hyporheic exchange within the watershed resulted in cooler August stream temperatures.

```{r norwest, fig.cap = "Recent historic (2002-2011) and projected (2040 and 2080) August mean stream temperature scenarios available from NorWeST (Isaak et al. 2017) for the Upper Walla Walla watershed."}
river_color = "lightskyblue1"
norwest_df = uww_rch_sf %>%
  select(S2_02_11,
         S30_2040D,
         S32_2080D,
         reach_leng) %>%
  mutate(S2_02_11 = replace(S2_02_11, S2_02_11 == -9999.00, NA),
         S30_2040D = replace(S30_2040D, S30_2040D == -9999.00, NA),
         S32_2080D = replace(S32_2080D, S32_2080D == -9999.00, NA)) %>%
  rename(`Recent historic` = S2_02_11,
         `2040 projected` = S30_2040D,
         `2080 projected` = S32_2080D) %>%
  pivot_longer(cols = c("Recent historic",
                        "2040 projected",
                        "2080 projected"),
               names_to = "scenario",
               values_to = "temp_c") %>%
  mutate(scenario = factor(scenario, levels = c("Recent historic", 
                                                "2040 projected", 
                                                "2080 projected")))

norwest_p = norwest_df %>%
  ggplot() +
  geom_sf(data = uww_huc_sf %>%
            st_union(),
          fill = NA,
          color = "gray50",
          size = 0.5) +
  geom_sf(color = river_color) +
  geom_sf(data = norwest_df,
          aes(color = temp_c),
          size = 0.5) +
  scale_color_viridis_c(option = "turbo") +
  facet_wrap(~scenario, 
             ncol = 2) +
  theme_bw() +
  theme(legend.position = "bottom",
        axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks = element_blank(),
        panel.grid.major = element_line(color = "transparent")) +
  labs(title = "NorWeST summer stream temperatures",
       color = expression("Temperature ("^o*"C)"))
norwest_p

```

```{r norwest-bp, out.width = "70%", fig.cap = "Boxplots showing distributions of recent historic (2002-2011) and projected (2040 and 2080) August mean stream temperatures from NorWeST (Isaak et al. 2017) for the Upper Walla Walla watershed."}
norwest_bp = norwest_df %>%
  group_by(scenario) %>%
  mutate(avg_temp = mean(temp_c, na.rm = T)) %>%
  ggplot(aes(x = reorder(scenario, temp_c),
             y = temp_c)) +
  geom_boxplot(aes(fill = avg_temp)) +
  scale_fill_viridis_c(option = "turbo",
                       name = expression("Mean Temp ("^o*"C)")) +
  theme_bw() +
  labs(y = expression("Temperature ("^o*"C)")) +
  theme(axis.title.x = element_blank(),
        axis.text.x = element_text(size = 12,
                                   color = "black"),
        axis.text.y = element_text(size = 12,
                                   color = "black"),
        legend.position = "none")
norwest_bp

```

## Fish Temperature Threshholds

Temperatures thresholds for Chinook salmon and steelhead were chosen based on the life-stage for the species potentially occupying habitat in the Upper Walla Walla watershed in August. Spawning and summer parr life-stages were considered for Chinook salmon and the summer parr life-stage was considered for steelhead (Table \@ref(tab:temp-thresh)). Temperature thresholds (expressed as the maximum weekly maximum temperature [MWMT]) identified in a literature review conducted by @Carter2005 were used for Chinook salmon and steelhead. Chinook spawning was observed in a wide range of temperatures (5.6 - 17.7^o^C); however, a majority of observations cite maximum temperatures at 14.5^o^C. For juvenile Chinook salmon summer parr rearing, 10 - 16^o^C represented an optimal range for growth and rearing. Temperatures above 19^o^C generally did not support Chinook salmon parr growth and Chinook salmon parr were rarely found in reaches with temperatures greater than, or equal to, 22^o^C. Juvenile steelhead summer parr temperature tolerances were similar to those of Chinook salmon, but had a higher end to their optimal range (18^o^C) for growth and rearing.

Bull trout tend to have more specific habitat requirements compared to other salmonids, typically needing colder stream temperatures. Although bull trout have been reported in stream temperatures above 20^o^C, they are seldom found in waters where temperatures exceed 15 - 16^o^C. Temperatures above 16^o^C are detrimental for bull trout feeding and growth and are unlikely to be suitable for their long-term survival [@Selong2001 and references therein]. At temperatures greater than 18^o^C, bull trout exhibit reduced consumption, growth, and survival [@Selong2001]. Pacific lamprey can tolerate temperature range of 5 - 25^o^C [@Clemens2017]. Pacific lamprey spawning typically occurs between 10 - 18^o^C with early juvenile development between 14 - 19^o^C, and preferred temperatures by adults ranging from 16 - 17^o^C [@Clemens2016; @Clemens2017]. Temperatures greater than 19^o^C are typically associated with stress, tissue damage, and potential mortality in Pacific lamprey [@Clemens2016].

```{r temp-thresh}
temp_thresh_tab = tibble(Species = c("Chinook", "Chinook", "Steelhead", "Bull Trout", "Pacific Lamprey"),
                         `Life Stage` = c("Spawning", "Summer Parr", "Summer Parr", "All", "All"),
                         Source = c("Carter 2005", "Carter 2005", "Carter 2005", "Selong et al. 2001", "Clemens et al. 2016, 2017"),
                         Timing = c("8/10 - 9/30", "6/10 - 10/15", "6/10 - 10/15", "7/1 - 8/31", "7/1 - 8/31"),
                         Minimum = c("NA", "4.5", "4.5", "0", "5"),
                         Optimum = c("5.6 - 14.5", "10 - 16", "10 - 18", "10.2 - 16", "10 - 17"),
                         Maximum = c("17.7", "19", "19", "18", "20"),
                         Acute = c("20", "22", "22", "20", "25")) %>%
  kable(booktabs = T,
        align = "cccccccc",
        caption = "Life stage timing, and minimum, optimum, maximum, and acute temperature (Celcius) thresholds for summer life-stages of Chinook salmon, steelhead, bull trout, and Pacific lamprey. Chinook salmon and steelhead temperatures are expressed as the 7-day Maximum Weekly Maximum Temperature (MWMT).") %>%
  kable_styling(full_width = F,
                position = "center",
                bootstrap_options = c("striped", "condensed"))
temp_thresh_tab

```

# Results

In nearly every future scenario, a larger portion of stream length within the Upper Walla Walla watershed exceeded optimum, maximum, and acute temperature thresholds (Table \@ref(tab:temp-thresh)) when moving from Recent Mean to Projected 2040 and 2080 climate change scenarios (Table \@ref(tab:temp-suit-tab)). The single exception was for Pacific Lamprey where stream temperatures didn't exceed their acute (lethal) temperature threshold of 25^o^C under any scenario. Under the Recent Mean stream temperature scenario, between 97.6 - 336.5 km of river (11.5% - 39.5% of stream habitat in the watershed) exceeded optimum temperatures depending on species and life stage. Recent Mean stream temperature exceeded optimal thermal thresholds for Chinook salmon spawning (5.6 - 14.5^o^ C) for 39.5% of available stream habitat. The length of stream that exceeded optimum temperatures further increased between 212.6 - 388.3 km (24.9% - 45.6%) under the 2040 projected scenario and 281.9 - 416.1 (33.1% - 48.8%) under the 2080 projected scenario dependent on species and life stage. Patterns for the percentage of stream length exceeding maximum temperatures were similar to those observed for optimum temperatures. Using the Recent Mean modeled temperatures, an estimated 14.4 km (1.7%) of the available stream habitat exceeded acute thresholds for Chinook salmon and bull trout. However, at least for Chinook salmon, steelhead, and bull trout, the portion of stream length that exceeded acute temperatures increased between 8.6 - 58.7 km (1.0% - 6.9%) and 27.4 - 123.5 km (3.2% - 14.5%) under the projected 2040 and 2080 climate warming scenarios, respectively (Table \@ref(tab:temp-suit-tab)).

```{r temp-suit-tab}
spec_ls = c("Chinook Spawning", "Chinook Parr", "Steelhead Parr", "Bull Trout", "Pacific Lamprey")
thresh = c("Within Optimum", "Above Optimum", "Above Maximum", "Above Acute")

temp_suit_tab = uww_rch_sf %>%
  select(`Recent historic` = S2_02_11,
         `2040 projected` = S30_2040D,
         `2080 projected` = S32_2080D,
         reach_leng) %>%
  mutate(`Recent historic` = replace(`Recent historic`, `Recent historic` == -9999.00, NA),
         `2040 projected` = replace(`2040 projected`, `2040 projected` == -9999.00, NA),
         `2080 projected` = replace(`2080 projected`, `2080 projected` == -9999.00, NA),
        `Recent minus 1` = `Recent historic` - 1) %>%
  pivot_longer(cols = c("Recent minus 1",
                        "Recent historic",
                        "2040 projected",
                        "2080 projected"),
               names_to = "scenario",
               values_to = "temp_c") %>%
  mutate(scenario = factor(scenario, levels = c("Recent minus 1",
                                                "Recent historic", 
                                                "2040 projected", 
                                                "2080 projected"))) %>%
  group_by(scenario) %>%
  expand_grid(spec_ls, thresh) %>%
  mutate(value = case_when(
    spec_ls == "Chinook Spawning" & thresh == "Within Optimum" & temp_c >= 5.6 & temp_c <= 14.5 ~ T,
    spec_ls == "Chinook Parr" & thresh == "Within Optimum" & temp_c >= 10 & temp_c <= 16 ~ T,
    spec_ls == "Steelhead Parr" & thresh == "Within Optimum" & temp_c >= 10 & temp_c <= 18 ~ T,
    spec_ls == "Bull Trout" & thresh == "Within Optimum" & temp_c >= 10.2 & temp_c <= 16 ~ T,
    spec_ls == "Pacific Lamprey" & thresh == "Within Optimum" & temp_c >= 10 & temp_c <= 17 ~ T,
    spec_ls == "Chinook Spawning" & thresh == "Above Optimum" & temp_c >= 14.5 ~ T,
    spec_ls == "Chinook Parr" & thresh == "Above Optimum" & temp_c >= 16 ~ T,
    spec_ls == "Steelhead Parr" & thresh == "Above Optimum" & temp_c >= 18 ~ T,
    spec_ls == "Bull Trout" & thresh == "Above Optimum" & temp_c >= 16 ~ T,
    spec_ls == "Pacific Lamprey" & thresh == "Above Optimum" & temp_c >= 17 ~ T,
    spec_ls == "Chinook Spawning" & thresh == "Above Maximum" & temp_c >= 17.7 ~ T,
    spec_ls == "Chinook Parr" & thresh == "Above Maximum" & temp_c >= 19 ~ T,
    spec_ls == "Steelhead Parr" & thresh == "Above Maximum" & temp_c >= 19 ~ T,
    spec_ls == "Bull Trout" & thresh == "Above Maximum" & temp_c >= 18 ~ T,
    spec_ls == "Pacific Lamprey" & thresh == "Above Maximum" & temp_c >= 20 ~ T,
    spec_ls == "Chinook Spawning" & thresh == "Above Acute" & temp_c >= 20 ~ T,
    spec_ls == "Chinook Parr" & thresh == "Above Acute" & temp_c >= 22 ~ T,
    spec_ls == "Steelhead Parr" & thresh == "Above Acute" & temp_c >= 22 ~ T,
    spec_ls == "Bull Trout" & thresh == "Above Acute" & temp_c >= 20 ~ T,
    spec_ls == "Pacific Lamprey" & thresh == "Above Acute" & temp_c >= 25 ~ T,
    TRUE ~ F
  )) %>%
  filter(value == T) %>%
  group_by(scenario, spec_ls, thresh) %>%
  summarize(length_km = sum(reach_leng) / 1000) %>%
  mutate(perc = round((length_km / 852.2079) * 100, 1),
         length_km = round(length_km, 1),
         `km (%)` = paste0(length_km,
                           " (",
                           perc,
                           "%)")) %>%
  select(`Life Stage` = spec_ls,
         Scenario = scenario,
         Threshold = thresh,
         `km (%)`) %>%
  pivot_wider(names_from = Threshold,
              values_from = `km (%)`) %>%
  select(`Life Stage`,
         `Scenario`,
         `Within Optimum`,
         `Above Optimum`,
         `Above Maximum`,
         `Above Acute`) %>%
  arrange(match(`Life Stage`, c("Chinook Spawning", 
                                "Chinook Parr", 
                                "Steelhead Parr", 
                                "Bull Trout", 
                                "Pacific Lamprey"))) %>%
  mutate(`Above Acute` = replace_na(`Above Acute`, "0 (0%)")) %>%
  kable(booktabs = T,
        align = "cccccc",
        caption = "The length (percentage) of stream within the Upper Walla Walla watershed (852.2 km total) that falls within optimum, above optimum, above maximum, and above acute temperature thresholds for each species, life stage combination and under recent historic and projected summer stream temperature scenarios.") %>%
  kable_styling(full_width = F,
                position = "center",
                bootstrap_options = c("striped", "condensed"))
temp_suit_tab 

```

The amount of stream within the optimum range for Chinook salmon spawning decreased from 494.5 (58.0% of available habitat) under the Recent Mean scenario to 459.8 (54.0% of available habitat) and 430.7 (50.5% of available habitat) under the 2040 and 2080 projected scenarios, respectively. Conversely, the amount of stream within the optimum range increases under the 2040 and 2080 warming scenarios for Chinook parr, steelhead parr, bull trout, and Pacific lamprey. This result is discussed further below.

Unsurprisingly, the hypothetical scenario where summer stream temperatures were decreased by 1^o^C relative to the Recent Mean reduced the stream length that exceeded optimum, maximum, and acute temperature thresholds for focal species and life stages. A reduction of 1^o^C relative to the Recent Mean scenario resulted in between 47.6 - 85.3 km (5.6 - 10.0%) less stream length that exceeded optimum temperatures and 7.4 - 64.1 km (0.9 - 7.5%) that exceeded maximum temperatures.

Figures \@ref(fig:optimum-map) and \@ref(fig:max-map) show reaches in the Upper Walla Walla watershed that exceeded optimum and maximum temperature thresholds for the focal species and life stages under each climate scenario. In general, additional upstream reaches become unsuitable moving to the 2040 and 2080 warming scenarios, depicted by the red colored reaches ("New Yes") under those scenarios (Figures \@ref(fig:optimum-map) and \@ref(fig:max-map)).

```{r optimum-map, fig.width = 6, fig.height = 7, fig.cap = "Maps depicting recent mean (2002-2011) and projected (2040 and 2080) August mean stream temperatures that exceeded the optimal temperatures for summer life stages of focal species within the Upper Walla Walla watershed. 'New Yes' indicates reaches that were below the optimal temperature thresholds during the prior scenarios but exceeded the optimal temperature thresholds for the scenario."}
optimum_df = norwest_df %>%
  mutate(`Chinook Spawning` = ifelse(temp_c > 14.5, "New Yes", "No"),
         `Chinook Parr` = ifelse(temp_c > 16, "New Yes", "No"),
         `Steelhead Parr` = ifelse(temp_c > 18, "New Yes", "No"),
         `Bull Trout` = ifelse(temp_c > 16, "New Yes", "No"),
         `Pacific Lamprey` = ifelse(temp_c > 17, "New Yes", "No")) %>%
  mutate(geom_text = as.character(st_geometry(.))) %>%
  group_by(geom_text) %>%
  mutate(`Chinook Spawning` = case_when(
    lag(`Chinook Spawning`) == "New Yes" ~ "Yes",
    is.na(lead(`Chinook Spawning`)) ~ `Chinook Spawning`,
    TRUE ~ `Chinook Spawning`
  )) %>%
  mutate(`Chinook Parr` = case_when(
    lag(`Chinook Parr`) == "New Yes" ~ "Yes",
    is.na(lead(`Chinook Parr`)) ~ `Chinook Parr`,
    TRUE ~ `Chinook Parr`
  )) %>%
  mutate(`Steelhead Parr` = case_when(
    lag(`Steelhead Parr`) == "New Yes" ~ "Yes",
    is.na(lead(`Steelhead Parr`)) ~ `Steelhead Parr`,
    TRUE ~ `Steelhead Parr`
  )) %>%
  mutate(`Bull Trout` = case_when(
    lag(`Bull Trout`) == "New Yes" ~ "Yes",
    is.na(lead(`Bull Trout`)) ~ `Bull Trout`,
    TRUE ~ `Bull Trout`
  )) %>%
  mutate(`Pacific Lamprey` = case_when(
    lag(`Pacific Lamprey`) == "New Yes" ~ "Yes",
    is.na(lead(`Pacific Lamprey`)) ~ `Pacific Lamprey`,
    TRUE ~ `Pacific Lamprey`
  )) %>%
  select(-geom_text) %>%
  pivot_longer(cols = c("Chinook Spawning",
                        "Chinook Parr",
                        "Steelhead Parr",
                        "Bull Trout",
                        "Pacific Lamprey"),
               names_to = "spec_ls",
               values_to = "above_optimum") %>%
  mutate(spec_ls = factor(spec_ls, levels = c("Chinook Spawning",
                                              "Chinook Parr",
                                              "Steelhead Parr",
                                              "Bull Trout",
                                              "Pacific Lamprey")))

optimum_p = optimum_df %>%
  ggplot() +
  geom_sf(data = uww_huc_sf %>%
            st_union(),
          fill = NA,
          color = "gray50",
          size = 0.5) +
  #geom_sf(color = river_color) +
  geom_sf(data = optimum_df,
          aes(color = above_optimum),
          size = 0.5) +
  scale_color_manual(values = c("Yes" = "gray",
                                "New Yes" = "orangered",
                                "No" = river_color)) +
  facet_grid(spec_ls ~ scenario) +
  theme_bw() +
  theme(legend.position = "top",
        axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks = element_blank(),
        panel.grid.major = element_line(color = "transparent")) +
  labs(color = "Above optimum range")
optimum_p

```

```{r max-map, fig.width = 6, fig.height = 7, fig.cap = "Maps depicting recent mean (2002-2011) and projected (2040 and 2080) August mean stream temperatures that exceeded the maximum temperatures for summer life stages of focal species within the Upper Walla Walla watershed. 'New Yes' indicates reaches that were below the maximum temperature thresholds during the prior scenarios but exceeded the maximum temperature thresholds for the scenario."}
maximum_df = norwest_df %>%
  mutate(`Chinook Spawning` = ifelse(temp_c > 17.7, "New Yes", "No"),
         `Chinook Parr` = ifelse(temp_c > 19, "New Yes", "No"),
         `Steelhead Parr` = ifelse(temp_c > 19, "New Yes", "No"),
         `Bull Trout` = ifelse(temp_c > 18, "New Yes", "No"),
         `Pacific Lamprey` = ifelse(temp_c > 20, "New Yes", "No")) %>%
  mutate(geom_text = as.character(st_geometry(.))) %>%
  group_by(geom_text) %>%
  mutate(`Chinook Spawning` = case_when(
    lag(`Chinook Spawning`) == "New Yes" ~ "Yes",
    is.na(lead(`Chinook Spawning`)) ~ `Chinook Spawning`,
    TRUE ~ `Chinook Spawning`
  )) %>%
  mutate(`Chinook Parr` = case_when(
    lag(`Chinook Parr`) == "New Yes" ~ "Yes",
    is.na(lead(`Chinook Parr`)) ~ `Chinook Parr`,
    TRUE ~ `Chinook Parr`
  )) %>%
  mutate(`Steelhead Parr` = case_when(
    lag(`Steelhead Parr`) == "New Yes" ~ "Yes",
    is.na(lead(`Steelhead Parr`)) ~ `Steelhead Parr`,
    TRUE ~ `Steelhead Parr`
  )) %>%
  mutate(`Bull Trout` = case_when(
    lag(`Bull Trout`) == "New Yes" ~ "Yes",
    is.na(lead(`Bull Trout`)) ~ `Bull Trout`,
    TRUE ~ `Bull Trout`
  )) %>%
  mutate(`Pacific Lamprey` = case_when(
    lag(`Pacific Lamprey`) == "New Yes" ~ "Yes",
    is.na(lead(`Pacific Lamprey`)) ~ `Pacific Lamprey`,
    TRUE ~ `Pacific Lamprey`
  )) %>%
  select(-geom_text) %>%
  pivot_longer(cols = c("Chinook Spawning",
                        "Chinook Parr",
                        "Steelhead Parr",
                        "Bull Trout",
                        "Pacific Lamprey"),
               names_to = "spec_ls",
               values_to = "above_maximum") %>%
  mutate(spec_ls = factor(spec_ls, levels = c("Chinook Spawning",
                                              "Chinook Parr",
                                              "Steelhead Parr",
                                              "Bull Trout",
                                              "Pacific Lamprey")))

maximum_p = maximum_df %>%
  ggplot() +
  geom_sf(data = uww_huc_sf %>%
            st_union(),
          fill = NA,
          color = "gray50",
          size = 0.5) +
  #geom_sf(color = river_color) +
  geom_sf(data = maximum_df,
          aes(color = above_maximum),
          size = 0.5) +
  scale_color_manual(values = c("Yes" = "gray",
                                "New Yes" = "red",
                                "No" = river_color)) +
  facet_grid(spec_ls ~ scenario) +
  theme_bw() +
  theme(legend.position = "top",
        axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks = element_blank(),
        panel.grid.major = element_line(color = "transparent")) +
  labs(color = "Above Maximum Temperature")
maximum_p

```

```{=html}
<!--
## Habitat Capacity Results

Describe changes in QRF relative habitat capacities using the 2040, 2080, and -1 scenarios using the RF extrapolation model. Do we see decreases in capacity under projected climate change scenarios? Alternatively, could some habitat capacity limitations be rectified through rehabilitation actions to cool stream temperatures by 1C.

* Re-run the RF extrapolations for the UWW also using the 2040, 2080, and -1 scenarios.
* Compare relative changes in capacity for those scenarios relative to the Recent Mean scenario
-->
```
# Discussion

An evaluation of recent historic (2002 - 2011) mean August stream temperatures showed that greater than 10% of the Upper Walla Walla watershed exceeds optimum temperatures for the species and summer life stages of interest, and that value increased to greater than 24% and 33% under projected 2040 and 2080 climate warming scenarios, respectively. Chinook salmon spawning, which typically occurs mid-August to mid-September for Snake River populations, was of most concern. We estimated that greater than 330 km of the watershed currently exceeds optimum temperatures for Chinook salmon spawning; that value increased to greater than 400 km or nearly half of the watershed under the 2080 projected scenario.

Actions to reduce peak summer water temperatures, such as riparian restoration, improved grazing practices, and channel narrowing should be considered in the Upper Walla Walla watershed, particularly in reaches identified in Figures \@ref(fig:optimum-map) and \@ref(fig:max-map). @Justice2017 similarly evaluated a 2080s climate change scenario and demonstrated that despite substantial increases in summer stream temperatures, basin-wide restoration of riparian vegetation and channel width could offset climate impacts in the Upper Grande Ronde and Catherine Creek watersheds in eastern Oregon.

# Literature Cited

<!-- The following line ensures the references appear here for the MS Word or HTML output files, rather than right at the end of the document (this will not work for PDF files):  -->

::: {#refs}
:::

````{=html}
<!-- misc deprecated code and figures 
```{r optimum-map2, eval = F, fig.width = 6, fig.height = 7, fig.cap = "Maps depicting whether recent mean (2002-2011) and projected (2040 and 2080) August mean stream temperatures exceed (TRUE) or are below (FALSE) the top optimal temperature for summer life-stages of focal species within the Upper Walla Walla watershed."}
optimum_df = norwest_df %>%
  mutate(`Chinook Spawning` = ifelse(temp_c > 14.5, T, F),
         `Chinook Parr` = ifelse(temp_c > 16, T, F),
         `Steelhead Parr` = ifelse(temp_c > 18, T, F),
         `Bull Trout` = ifelse(temp_c > 16, T, F),
         `Pacific Lamprey` = ifelse(temp_c > 17, T, F)) %>%
  pivot_longer(cols = c("Chinook Spawning",
                        "Chinook Parr",
                        "Steelhead Parr",
                        "Bull Trout",
                        "Pacific Lamprey"),
               names_to = "spec_ls",
               values_to = "above_optimum") %>%
  mutate(above_optimum = replace_na(above_optimum, F)) %>%
  mutate(spec_ls = factor(spec_ls, levels = c("Chinook Spawning",
                                              "Chinook Parr",
                                              "Steelhead Parr",
                                              "Bull Trout",
                                              "Pacific Lamprey")))

optimum_p = optimum_df %>%
  ggplot() +
  geom_sf(data = uww_huc_sf %>%
            st_union(),
          fill = NA,
          color = "gray50",
          size = 0.5) +
  #geom_sf(color = river_color) +
  geom_sf(data = optimum_df,
          aes(color = above_optimum),
          size = 0.5) +
  scale_color_manual(values = c("FALSE" = river_color,
                                "TRUE" = "orangered")) +
  facet_grid(spec_ls ~ scenario) +
  theme_bw() +
  theme(legend.position = "top",
        axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks = element_blank()) +
  labs(color = "Above Optimum Range")
optimum_p

```

```{r current_temp_map}

river_color = "lightskyblue1"

# Current temp map
temp_map_cur = uww_rch_sf %>%
  ggplot() +
  geom_sf(data = uww_huc_sf %>%
            st_union() %>%
            nngeo::st_remove_holes(),
          fill = NA,
          color = "gray50") +
  geom_sf(color = river_color) +
  geom_sf(data = uww_rch_sf %>%
            mutate(S2_02_11 = replace(S2_02_11, S2_02_11 == -9999.00, NA)),
          aes(color = S2_02_11),
          size = 1) +
  scale_color_viridis_c(direction = 1, limits = c(5,25)) +
  #theme_bw() +
  theme(legend.position = "bottom",
        axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks = element_blank()) +
  labs(title = "2002-2011 historical composite scenario",
       color = expression("Temperature ("^o*"C)"))

# 2040 temp map
temp_map_2040 = uww_rch_sf %>%
  ggplot() +
  geom_sf(data = uww_huc_sf %>%
            st_union() %>%
            nngeo::st_remove_holes(),
          fill = NA,
          color = "gray50") +
  geom_sf(color = river_color) +
  geom_sf(data = uww_rch_sf %>%
            mutate(S30_2040D = replace(S30_2040D, S30_2040D == -9999.00, NA)),
          aes(color = S30_2040D),
          size = 1) +
  scale_color_viridis_c(direction = 1, limits = c(5,25)) +
  #theme_bw() +
  theme(legend.position = "bottom",
        axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks = element_blank()) +
  labs(title = "2040 future scenario",
       color = expression("Temperature ("^o*"C)"))

# 2080 temp map
temp_map_2080 = uww_rch_sf %>%
  ggplot() +
  geom_sf(data = uww_huc_sf %>%
            st_union() %>%
            nngeo::st_remove_holes(),
          fill = NA,
          color = "gray50") +
  geom_sf(color = river_color) +
  geom_sf(data = uww_rch_sf %>%
            mutate(S32_2080D = replace(S32_2080D, S32_2080D == -9999.00, NA)),
          aes(color = S32_2080D),
          size = 1) +
  scale_color_viridis_c(direction = 1, limits = c(5,25)) +
  #theme_bw() +
  theme(legend.position = "bottom",
        axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks = element_blank()) +
  labs(title = "2080 future scenario",
       color = expression("Temperature ("^o*"C)"))

# -1C results
temp_map_1C = uww_rch_sf %>%
  ggplot() +
  geom_sf(data = uww_huc_sf %>%
            st_union() %>%
            nngeo::st_remove_holes(),
          fill = NA,
          color = "gray50") +
  geom_sf(color = river_color) +
  geom_sf(data = uww_rch_sf %>%
            mutate(S2_02_11 = replace(S2_02_11, S2_02_11 == -9999.00, NA)),
          aes(color = (S2_02_11-1)),
          size = 1) +
  scale_color_viridis_c(direction = 1, limits = c(5,25)) +
  #theme_bw() +
  theme(legend.position = "bottom",
        axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks = element_blank()) +
  labs(title = expression("Hypothetical restoration effect on \n historic composite scenario (-1"^o*"C)"),
       color = expression("Temperature ("^o*"C)"))


# 2040 comparison
temp_rel_map_2040 = uww_rch_sf %>%
  ggplot() +
  geom_sf(data = uww_huc_sf %>%
            st_union() %>%
            nngeo::st_remove_holes(),
          fill = NA,
          color = "gray50") +
  geom_sf(color = river_color) +
  geom_sf(data = uww_rch_sf %>%
            mutate(S30_2040D = replace(S30_2040D, S30_2040D == -9999.00, NA),
                   S2_02_11 = replace(S2_02_11, S2_02_11 == -9999.00, NA),
                   temp_dif = S30_2040D - S2_02_11),
          aes(color = temp_dif),
          size = 1) +
  scale_color_viridis_c(direction = 1,limits = c(-1,2.5)) +
#scale_fill_gradientn(limits = c(1,3)) +
  #theme_bw() +
  theme(legend.position = "bottom",
        axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks = element_blank()) +
  labs(title = "2040 future scenario",
       color = expression("Temperature ("^o*"C)"))

# 2080 comparison
temp_rel_map_2080 = uww_rch_sf %>%
  ggplot() +
  geom_sf(data = uww_huc_sf %>%
            st_union() %>%
            nngeo::st_remove_holes(),
          fill = NA,
          color = "gray50") +
  geom_sf(color = river_color) +
  geom_sf(data = uww_rch_sf %>%
            mutate(S32_2080D = replace(S32_2080D, S32_2080D == -9999.00, NA),
                   S2_02_11 = replace(S2_02_11, S2_02_11 == -9999.00, NA),
                   temp_dif = S32_2080D - S2_02_11),
          aes(color = temp_dif),
          size = 1) +
  scale_color_viridis_c(direction = 1,limits = c(-1,2.5)) +
  #theme_bw() +
  theme(legend.position = "bottom",
        axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks = element_blank()) +
  labs(title = "2080 future scenario",
       color = expression("Temperature ("^o*"C)"))


# -1C results
temp_rel_map_1C = uww_rch_sf %>%
  ggplot() +
  geom_sf(data = uww_huc_sf %>%
            st_union() %>%
            nngeo::st_remove_holes(),
          fill = NA,
          color = "gray50") +
  geom_sf(color = river_color) +
  geom_sf(data = uww_rch_sf %>%
            mutate(S2_02_11 = replace(S2_02_11, S2_02_11 == -9999.00, NA)),
          aes(color = (S2_02_11-1)),
          size = 1) +
  scale_color_viridis_c(direction = 1,limits = c(-1,2.5)) +
  #theme_bw() +
  theme(legend.position = "bottom",
        axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks = element_blank()) +
  labs(title = expression("Hypothetical restoration effect on \n historic composite scenario (-1"^o*"C)"),
       color = expression("Temperature ("^o*"C)"))

```

```{r current-temp-maps, fig.cap = "NorWeST average August mean stream temperatures for the Upper Walla Walla."}

temp_map_cur

```

```{r 2040-temp-maps, fig.cap = "NorWeST average August mean stream temperatures for the Upper Walla Walla."}

temp_map_2040

```

```{r 2080-temp-maps, fig.cap = "NorWeST average August mean stream temperatures for the Upper Walla Walla."}

temp_map_2080

```

```{r 1C-temp-maps, fig.cap = "NorWeST average August mean stream temperatures for the Upper Walla Walla."}
temp_map_1C

```

```{r 2040-temp-comparison-maps, fig.cap = "Difference in projected NorWeST average August mean stream temperatures for 2040relative to the 2002-2011 historical composite scanerio for the Upper Walla Walla."}

ggarrange(temp_rel_map_2040)

```

```{r 2080-temp-comparison-maps, fig.cap = "Difference in projected NorWeST average August mean stream temperatures for 2080 relative to the 2002-2011 historical composite scanerio for the Upper Walla Walla."}

ggarrange(temp_rel_map_2080)

```

```{r 1C-temp-comparison-maps, fig.cap = "Difference in projected NorWeST average August mean stream temperatures for - 1oC scenario relative to the 2002-2011 historical composite scanerio for the Upper Walla Walla."}

ggarrange(temp_rel_map_1C)

```
-->
````
