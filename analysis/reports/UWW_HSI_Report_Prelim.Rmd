---
title: "Upper Walla Walla Watershed - Hydraulic Habitat Suitability Analysis"

author:
  - name: Mike Ackerman
    email: mike.ackerman@mthoodenvironmental.com
    institute: [mhe_mccall]
    correspondence: true
  - name: Tulley Mackey
    email: tulley.mackey@mthoodenvironmental.com
    institute: [mhe_salmon]
    correspondence: true
institute:
  - mhe_mccall: Mount Hood Environmental, PO Box 4282, McCall, Idaho, 83638, USA
  - mhe_salmon: Mount Hood Environmental, 1009 South Daisy Street, Salmon, ID 83467, USA
date: '`r format(Sys.Date(), "%B %d, %Y")`'
output:
  bookdown::html_document2:
    theme: yeti
    toc: yes
    toc_depth: 2
    toc_float:
      fig_height: 8
      fig_width: 10
      collapsed: yes
      smooth_scroll: yes
    number_sections: yes
    pandoc_args:
    - --lua-filter=../templates/scholarly-metadata.lua
    - --lua-filter=../templates/author-info-blocks.lua
    - --lua-filter=../templates/pagebreak.lua  
csl: "../templates/journal-of-archaeological-science.csl"
bibliography:
  - AckermanLibrary.bib
always_allow_html: yes
---

<!-- the following inserts MHE logo into header -->

```{=html}
<script>
   $(document).ready(function() {
     $head = $('#header');
     $head.prepend('<img src=\"logo.jpg\" style=\"float: right;width: 150px;\"/>')
   });
</script>
```
```{r setup, echo = FALSE, message = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  warning = FALSE,
  message = FALSE,
  echo = FALSE,
  comment = "#>",
  fig.path = "../figures/",
  dpi = 600
)

options(knitr.kable.NA = '--')

``` 

```{r load-library, echo = FALSE, message = FALSE, warning = FALSE, results = 'hide'}

# load knitr for markdown
library(knitr)
library(kableExtra)

# load packages for analysis
library(tidyverse)
library(here)
library(ggpubr)
library(sf)
library(readxl)
library(ggmap)
library(nngeo)
library(janitor)
library(readr)
library(gridExtra)
library(reshape2)
library(dplyr)
library(ggplot2)

theme_set(theme_pubr(x.text.angle = 45,
                     base_size = 8))
```

# Background

Water is the cornerstone of First Foods production and inherently tied to the five fundamental touchstones: hydrology, geomorphology, habitat and network connectivity, riverine biotic community, and riparian vegetation [@Jones2008]. These touchstones form the Umatilla River Vision, a holistic approach to water quality restoration. In support of the Vision, population status and habitat use of riverine fishes defined as First Foods (including Endangered Species Act [ESA] listed middle Columbia River summer-run steelhead, spring-run Chinook salmon, bull trout, and Pacific lamprey) have been identified as critical data needs in the assessment of biotic communities [@Jones2008]. The decline of anadromous Pacific salmonid populations (*Oncorhynchus* spp.) across the Pacific Northwest, USA, has prompted numerous actions aimed at reversing that trend. These actions are often categorized into four 'H's' - harvest modification, habitat rehabilitation, hydroelectric operations, and hatchery practices. While these actions can influence salmonid survival, predicting the potential magnitude of population uplift and developing the most cost-effective and sustainable solutions is a complex task that results in substantial uncertainties. Recovery plans (e.g., @NOAA2009) have identified adult escapement targets at the population scale, providing a quantitative metric useful for evaluating the magnitude of survival improvements (across life-stages) required. These abundance targets provide a benchmark against which habitat rehabilitation actions can be measured. In this document, we assess the hydraulic suitability (i.e., depth and velocity) in the upper Walla Walla watershed to support select life stages of spring-run Chinook salmon (hereafter Chinook salmon) and summer-run steelhead (hereafter steelhead). By comparing depth and velocity suitability curves for Chinook salmon and steelhead, developed by Maret et al. (2006), to continuous modeled depths and velocities (supported by bathymetric Light Detection and Ranging; LiDAR) available for the upper Walla Walla, we can further the understanding of how habitat, related specifically to hydraulics and the governing morphology, may be limiting recovery of Chinook salmon and steelhead. This information can help identify geomorphic reaches where existing depth and velocity may be limiting particular species and life stages, which could prove useful for prioritizing habitat rehabilitation. The incorporation of a hydraulic suitability analysis with habitat capacity (QRF), temperature, and morphological analyses allows for a robust assessment of the existing habitat conditions and limiting factors for target species and life stages.

## Focal Species

The focal species for the Hydraulic Habitat Suitability (HHS) analysis are:

-   Spring-run Chinook salmon (*Oncorhynchus tshawytscha*; hereafter Chinook salmon)
-   Middle Columbia River summer steelhead (*O. mykiss*; hereafter steelhead; ESA-listed "threatened")

While our HHS models specifically address Chinook salmon and steelhead, any uplift in habitat for these species are also expected to benefit:

-   Columbia River bull trout (*Salvelinus confluentus*; ESA-listed "threatened")
-   Pacific lamprey (*Lampetra tridentata*)

## Study Area

This assessment will be focused on the alluvial channel of the Walla Walla River from the confluence with Dry Creek near Lowden, Washington, to the headwaters of the North and South forks of the Walla Walla River. The primary study area includes approximately 70 miles of stream. The secondary study area includes the catchment of the primary study area which encompasses approximately 885 square miles.

## Objective

Evaluate the composite suitability of geomorphic reaches in the North Fork (NF), South Fork (SF), and upper mainstem Walla Walla River (MS) watersheds based on modeled depth and velocity rasters supported by  multi-year LiDAR sampling events that encompass the study reaches. Composite suitability is evaluated for both Chinook salmon and steelhead at multiple life stages, including adult spawning and juvenile rearing for Chinook and juvenile rearing for steelhead, at base flow discharge scenarios (see Table \@ref(tab:scenarios-tab)).

# Methods

We provide methods for calculating the composite (depth & velocity) suitability, at each pixel, for a single discharge scenario. Suitability results for pixels are then summarized both by river kilometer (rkm) and geomorphic reach, including visualizations of the results. For reference, Table \@ref(tab:rkm-geo-rch) shows the minimum and maximum river kilometer for each geomorphic reach and watershed. A given scenario includes a year, watershed, species, and life stage combination. Here, we provide detailed methods for Scenario 1 in Table \@ref(tab:scenarios-tab): NF, Chinook salmon, juvenile rearing. The same methods were then applied across all scenarios utilizing the appropriate depth and velocity suitability curves (depending on species and adult versus juvenile) or differing input depth and velocity rasters (depending year). All scenarios evaluated are summarized in Table \@ref(tab:scenarios-tab). All data, scripts, outputs, and reports for this analysis can be found within the `UWW.plan` repository at https://github.com/Mount-Hood-Environmental/UWW.plan. 

Detailed methods are as follows:

1. Raster .tifs containing depth and velocity values derived from 2019 and 2021 LiDAR data were imported into R [@RCoreTeam2021] with a raster pixel resolution of 1m x 1m. Rasters were obtained from Rio Applied Science and Engineering (Rio ASE).

2. Import polygon shapefiles delineating the river kilometers and geomorphic reaches defined by ????. These shapefiles are used to interrogate the depth and velocity .tifs to determine which rkm or geomorphic reach each depth and velocity pixel falls within.

3. Read in the depth and velocity habitat suitability curves for Chinook salmon and steelhead from @Maret2006. Depth and velocity HSC curves were available for both species for life stages of interest. Functions to calculate the suitability for a given depth or velocity are available [here](https://github.com/Mount-Hood-Environmental/UWW.plan/analysis/scripts/hsi/hsi_curves.R) in the [UWW.plan repo](https://github.com/Mount-Hood-Environmental/UWW.plan/). The [Habitat Suitability] section below shows the HSC curves used from @Maret2006.

4. Use the HSC curves to calculate the depth and velocity suitability for each raster pixel. The result is two new rasters each containing the calculated depth and velocity suitability values, respectively.

5. Calculate the composite suitability value for each raster pixel as the geometric mean of the depth and velocity suitability values. The result is a third composite suitability raster.

6. Extract the composite suitability values located within each rkm for each pixel into an R dataframe. The dataframe can then be used to summarize and visualize the composite suitability by rkm or geomorphic reach for the given year, watershed, species, and life stage.

7. Store the composite suitability values, rkms and geomorphic reaches for each pixel. These results are currently stored in the [output/hsi_raw/](https://github.com/Mount-Hood-Environmental/analysis/hsi_outputs) directory in the [repo](https://github.com/Mount-Hood-Environmental/UWW.plan/).

8. Calculate the total wetted area, weighted usable area, and normalized weighted usable area (i.e., hydraulic habitat suitability) for each species, life stage, and rkm / geomorphic reach. The total wetted area was calculated by counting the total number of pixels (each with a known area), that occur within each rkm and wetted area for a given scenario. The weighted usable area (WUA) was calculated by summing the composite suitability values of all pixels within that same area. And finally, the normalized weighted usable area i.e., hydraulic habitat suitability (HHS), was calculated by dividing the WUA by the total wetted area for each rkm or geomorphic reach.

Finally, composite suitability values were visualized by year, watershed, species, life stage (Chinook adult spawning, Chinook and steelhead juvenile rearing), and rkm / geomorphic reach. Violin plots were used to show the distribution of composite suitability values, by geomorphic reach, and are provided in the [Results]. Maps showing the hydraulic habitat suitability, by rkm / geomorphic reach, are provided by species and life stage for each watershed, as well as plots showing the WUA and HHS for each individual scenario evaluated.

The resulting raster .tifs showing depth, velocity, and composite suitability are too large to store in a https://github.com/ repository, but are available from the authors upon request.

```{r rkm-geo-rch}
geo_reach = read_csv(here("analysis/data/raw_data/reach_partitions/Geo_reaches_corrected.csv")) %>%
rename(Watershed = Strm_Name,
       min = From_RKM,
       max = To_RKM,
       'Geomorphic Reach' = Reach_ID) %>%
  relocate("Watershed", "Geomorphic Reach", "min", "max") %>%
  select(Watershed, 'Geomorphic Reach', min, max)

geo_reach$`Geomorphic Reach`= ordered(geo_reach$`Geomorphic Reach`, levels = c("GR_01_MS",
                                                                               "GR_02_MS",
                                                                               "GR_03_MS",
                                                                               "GR_04_MS",
                                                                               "GR_05_MS",
                                                                               "GR_01_NF",
                                                                               "GR_02_NF",
                                                                               "GR_03_NF",
                                                                               "GR_04_NF",
                                                                               "GR_05_NF",
                                                                               "GR_01_SF",
                                                                               "GR_02_SF",
                                                                               "GR_03_SF",
                                                                               "GR_04_SF",
                                                                               "GR_05_SF"))
geo_reach = geo_reach %>%
  arrange(factor(`Geomorphic Reach`)) %>%

kable(booktabs = T,
 align = "ccccccc",
caption = "The minimum and maximum river kilometer contained within each geomorphic reach. 
        River kilometers increase as you move upstream") %>% kable_styling(full_width = T,
 position = "center",
 bootstrap_options = c("striped", "condensed"))
geo_reach
```


## Habitat Suitability

```{r hsi-curves}
hsi_df = read_csv(here("analysis/data/raw_data/maret_hsi_curves_for_r_uww.csv"))

```

Figures \@ref(fig:chnk-hsi) and \@ref(fig:sthd-hsi) show HSI curves for Chinook salmon and steelhead from @Maret2006, respectively, used here. These curves are used to calculate the depth or velocity suitability value for each pixel within a given scenario. The composite suitability for a pixel is then calculated as the geometric mean of those values. As an example, using juvenile Chinook salmon and depth, if a pixel has a depth of 0m, that pixel is assigned a suitability of 0 whereas if the depth is greater than approximately 0.6m it is assigned a suitability of 1; a depth of 0.5m would be assigned a suitability of $\sim$ 0.7.

```{r chnk-hsi, fig.height = 4, fig.cap = "Suitability indices at varying depths and velocities for juvenile rearing and adult spawning for Chinook salmon from Maret et al. (2006)."}
# chinook hsi curves
chnk_hsi = hsi_df %>%
  filter(species == "Chinook") %>%
  ggplot(aes(x = value_m, y = si)) +
  geom_line(color = "royalblue3", size = 1.5) +
  coord_cartesian(xlim = c(0,2)) +
  theme_bw() +
  facet_grid(variable ~ life_stage) +
  labs(x = "Value (m | m/s)",
       y = "Suitability Index",
       title = "Chinook salmon")
chnk_hsi

```

```{r sthd-hsi, fig.height = 4, fig.cap = "Suitability indices at varying depths and velocities for juvenile rearing for steelhead from Maret et al. (2006)."}
sthd_hsi = hsi_df %>%
  filter(species == "Steelhead") %>%
  ggplot(aes(x = value_m, y = si)) +
  geom_line(color = "royalblue3", size = 1.5) +
  coord_cartesian(xlim = c(0,2)) +
  theme_bw() +
  facet_grid( life_stage ~ variable) +
  labs(x = "Value (m | m/s)",
       y = "Suitability Index",
       title = "Steelhead")
sthd_hsi

```

## Scenarios

```{r scenarios-tab}
scenarios_tab = tibble(Scenario = c(1:6),
    Watershed = c("Walla Walla River","Walla Walla River","Walla Walla River","Walla Walla River","Walla                        Walla River", "Walla Walla River"),
    Species = c("Chinook", "Chinook", "Chinook", "Chinook", "Steelhead", "Steelhead"),
    Life_Stage = c("Juvenile", "Juvenile", "Spawning", "Spawning", "Juvenile", "Juvenile"),
    Year = c("2019","2021","2019","2021","2019","2021"),
    Depth_Raster = c("Combined_2019lidar_LowFlow_Depth_metric.tif","Combined_2021lidar_LowFlow_Depth_metric.tif",
                     "Combined_2019lidar_LowFlow_Depth_metric.tif","Combined_2021lidar_LowFlow_Depth_metric.tif",
                     "Combined_2019lidar_LowFlow_Depth_metric.tif","Combined_2021lidar_LowFlow_Depth_metric.tif"),
    Velocity_Raster = c("Combined_2019lidar_LowFlow_Velocity_metric.tif","Combined_2021lidar_LowFlow_Velocity_metric.tif",
                        "Combined_2019lidar_LowFlow_Velocity_metric.tif","Combined_2021lidar_LowFlow_Velocity_metric.tif",
                        "Combined_2019lidar_LowFlow_Velocity_metric.tif","Combined_2021lidar_LowFlow_Velocity_metric.tif")) %>%

 kable(booktabs = T,
        align = "ccccccc",
       caption = "Scenarios for which we evaluated the composite suitability (depth & velocity), depth and velocity within geomorphic reaches including the corresponding depth and velocity rasters used for each scenario.") %>%
kable_styling(full_width = F,
position = "center",
bootstrap_options = c("striped", "condensed"))
scenarios_tab
```

We evaluated `r nrow(scenarios_tab)` scenarios in total which are summarized in Table \@ref(tab:scenarios-tab). For all scenarios, we used rasters from a discharge scenario representative of low flow conditions. Two raster datasets from 2019 and 2021 were assessed for suitability to evaluate changes to habitat as a result of extensive flooding in 2020.

# Results

Here, we summarize the distribution of composite, depth and velocity suitability values by geomorphic reach (as box plots), mean HHS by rkm (as maps), and WUA and HHS by rkm (line plots) by species, life stage and year. Raw outputs and raster .tifs of depth, velocity, and composite suitability values are available in the [UWW.plan repo](https://github.com/Mount-Hood-Environmental/UWW.plan) or from the authors.

## Chinook Spawning 2021

Figure \@ref(fig:uww-chnk-spw-plot) shows the composite hydraulic suitability, and depth and velocity suitability within the Upper Walla Walla watershed to support Chinook salmon spawning under post-flood conditions in 2021. In general, the hydraulic suitability for spawning, 

```{r uww-chnk-spw-plot, fig.height = 7, fig.cap = "Box plots showing the distribution of suitability values for composite, depth and velocity for Chinook spawning across geomorphic reaches in the Upper Walla Walla watershed in 2021. Results for composite suitability (geometric mean of depth and velocity suitability), depth and velocity are shown to help identify hydarulic metric limitations."}

# upload hsi metric raw files for each species/life stage and year into one df
hsi_raw = list.files("S:/main/data/habitat/HSI/UWW_hsi_results/raw_results", pattern = "*.rda", full.names = T) %>%
  map_df(~read_rds(.))%>%
  mutate(watershed = if_else(grepl("MS", ID), "Mainstem", ID)) %>%
  mutate(watershed = if_else(grepl("NF", ID), "North Fork", watershed)) %>%
  mutate(watershed = if_else(grepl("SF", ID), "South Fork", watershed))

# Chinook spawning 2021 #
chnk_spw_2021_geo = hsi_raw %>%
  filter(year == "2021",
         scenario == "chnk_spw",
         str_starts(ID, "GR")) %>%
  mutate(ID = factor(ID, levels = c("GR_01_MS",
                                    "GR_02_MS",
                                    "GR_03_MS",
                                    "GR_04_MS",
                                    "GR_05_MS",
                                    "GR_01_NF",
                                    "GR_02_NF",
                                    "GR_03_NF",
                                    "GR_04_NF",
                                    "GR_05_NF",
                                    "GR_01_SF",
                                    "GR_02_SF",
                                    "GR_03_SF",
                                    "GR_04_SF",
                                    "GR_05_SF"))) %>%
  ggplot(aes(x = ID, y = value, fill = watershed)) +
  geom_boxplot() +
  facet_wrap(~ metric, nrow = 3) +
  theme_bw() +
  labs(x = "Geomorphic Reach",
       y = "Suitability Index",
       title = "Chinook Spawning 2021") +
  theme(plot.title = element_text(hjust = 0.5), legend.position = "top",
        axis.text.x = element_text(angle = 45, vjust = 0.5),
        axis.title.x = element_text(margin = margin(t = 10)),
        axis.title.y = element_text(margin = margin(r = 10)))
chnk_spw_2021_geo
#ggsave("../output/figures/ul_cs_plot.pdf", ul_p)
```

## Chinook Juvenile Rearing 2021

Figure \@ref(fig:uww-chnk-juv-plot) shows the composite hydraulic suitability, and depth and velocity suitability within the Upper Walla Walla watershed to support Chinook salmon juvenile rearing under post-flood conditions in 2021. In general, the hydraulic suitability for juvenile rearing,

```{r uww-chnk-juv-plot, fig.height = 7, fig.cap = "Box plots showing the distribution of suitability values for composite, depth and velocity for Chinook juvenile rearing across geomorphic reaches in the Upper Walla Walla watershed in 2021. Results for composite suitability (geometric mean of depth and velocity suitability), depth and velocity are shown to help identify hydraulic metric limitations."}

# Chinook juvenile rearing 2021 #
chnk_juv_2021_geo = hsi_raw %>%
  filter(year == "2021",
         scenario == "chnk_juv",
         str_starts(ID, "GR")) %>%
  mutate(ID = factor(ID, levels = c("GR_01_MS",
                                    "GR_02_MS",
                                    "GR_03_MS",
                                    "GR_04_MS",
                                    "GR_05_MS",
                                    "GR_01_NF",
                                    "GR_02_NF",
                                    "GR_03_NF",
                                    "GR_04_NF",
                                    "GR_05_NF",
                                    "GR_01_SF",
                                    "GR_02_SF",
                                    "GR_03_SF",
                                    "GR_04_SF",
                                    "GR_05_SF"))) %>%
  ggplot(aes(x = ID, y = value, fill = watershed)) +
  geom_boxplot() +
  facet_wrap(~ metric, nrow = 3) +
  theme_bw() +
  labs(x = "Geomorphic Reach",
       y = "Suitability Index",
       title = "Chinook Juvenile Rearing 2021") +
  theme(plot.title = element_text(hjust = 0.5), legend.position = "top",
        axis.text.x = element_text(angle = 45, vjust = 0.5),
        axis.title.x = element_text(margin = margin(t = 10)),
        axis.title.y = element_text(margin = margin(r = 10)))
chnk_juv_2021_geo
```

## Steelhead Juvenile Rearing 2021

Figure \@ref(fig:uww-sthd-juv-plot) shows the composite hydraulic suitability, and depth and velocity suitability within the Upper Walla Walla watershed to support steelhead juvenile rearing under post-flood conditions in 2021. In general, the hydraulic suitability for juvenile rearing,

```{r uww-sthd-juv-plot, fig.height = 7, fig.cap = "Box plots showing the distribution of suitability values for composite, depth and velocity for Chinook juvenile rearing across geomorphic reaches in the Upper Walla Walla watershed in 2021. Results for composite suitability (geometric mean of depth and velocity suitability), depth and velocity are shown to help identify hydarulic metric limitations."}

# steelhead juvenile rearing 2021 #
sthd_juv_2021_geo = hsi_raw %>%
  filter(year == "2021",
         scenario == "sthd_juv",
         str_starts(ID, "GR")) %>%
  mutate(ID = factor(ID, levels = c("GR_01_MS",
                                    "GR_02_MS",
                                    "GR_03_MS",
                                    "GR_04_MS",
                                    "GR_05_MS",
                                    "GR_01_NF",
                                    "GR_02_NF",
                                    "GR_03_NF",
                                    "GR_04_NF",
                                    "GR_05_NF",
                                    "GR_01_SF",
                                    "GR_02_SF",
                                    "GR_03_SF",
                                    "GR_04_SF",
                                    "GR_05_SF"))) %>%
  ggplot(aes(x = ID, y = value, fill = watershed)) +
  geom_boxplot() +
  facet_wrap(~ metric, nrow = 3) +
  theme_bw() +
  labs(x = "Geomorphic Reach",
       y = "Suitability Index",
       title = "Steelhead Juvenile Rearing 2021") +
  theme(plot.title = element_text(hjust = 0.5), legend.position = "top",
        axis.text.x = element_text(angle = 45, vjust = 0.5),
        axis.title.x = element_text(margin = margin(t = 10)),
        axis.title.y = element_text(margin = margin(r = 10)))
sthd_juv_2021_geo
```

Figure \@ref(fig:hss-map-rkm) shows the hydraulic habitat suitability of each river kilometer by species, life stage, and year with the outlines of the geomorphic reaches in the Upper Walla Walla watershed. 

```{r hss-map-rkm, results = 'hide', fig.cap = "Map showing the hydraulic habitat suitability by life stage and year for Chinook salmon and steelhead in the Upper Walla Walla watershed, plotted by river kilometer with geomorphic reaches also shown."}

# HHS map by scenario
rkm = (st_read(here("analysis/data/derived_data/hsi/rkm_poly.shp"))) %>%
  select(Reach_ID, Strm_Name, geometry) %>%
  rename(watershed = Strm_Name)

geo = (st_read(here("analysis/data/derived_data/hsi/geom_buffer.shp"))) %>%
  select(Reach, geometry)

geo_ms = geo %>%
  filter(str_starts(Reach, "MS"))

geo_nf = geo %>%
  filter(str_starts(Reach, "NF"))

geo_sf = geo %>%
  filter(str_starts(Reach, "SF"))

hhs = list.files("analysis/hsi_outputs/csvs", pattern = "*.csv", full.names = T)%>%
  map_df(~read_csv(.)) %>%
  rename(Reach_ID = ID) %>%
  filter(str_starts(Reach_ID, "RKM"))

scenario_labs = c("Chinook Juvenile", "Chinook Spawning", "Steelhead Juvenile")
names(scenario_labs) = c("chnk_juv", "chnk_spw", "sthd_juv")

# HHS maps
hhs_rkm = merge(rkm, hhs, by = "Reach_ID") %>%
ggplot() +
geom_sf(aes(fill = HHS)) +
scale_fill_distiller(palette = "Spectral",
                      direction = 1,
                      name = "Hydraulic Habitat Suitability (HHS)") +
  geom_sf(data = geo, color = 'grey50',
          fill = NA) +
  geom_sf_text(data = geo_ms, aes(label = Reach),
                color = 'black',
                size = 2,
                nudge_x = -4000,
                nudge_y = -1000) +
  geom_sf_text(data = geo_nf, aes(label = Reach),
                color = 'black',
                size = 2,
                nudge_x = 50,
                nudge_y = 2000) +
  geom_sf_text(data = geo_sf, aes(label = Reach),
                color = 'black',
                size = 2,
                nudge_x = 50,
                nudge_y = -3000) +
  theme(axis.text = element_blank(),
        axis.title = element_blank(),
        axis.ticks = element_blank(),
        panel.grid = element_blank(),
        legend.position = "top") +
  facet_grid(year ~ scenario, labeller = labeller(scenario = scenario_labs))
hhs_rkm
```

Figure \@ref(fig:depth-map-rkm) shows the habitat suitability by depth of each river kilometer by species, life stage, and year with the outlines of the geomorphic reaches in the Upper Walla Walla watershed. 

```{r depth-map-rkm, results = 'hide', fig.cap = "Map showing the depth suitability by life stage and year for Chinook salmon and steelhead in the Upper Walla Walla River, plotted by river kilometer with geomorphic reaches also shown."}

# Depth maps
# HHS maps
depth_rkm = merge(rkm, hhs, by = "Reach_ID") %>%
ggplot() +
geom_sf(aes(fill = d_HSI)) +
scale_fill_distiller(palette = "Spectral",
                      direction = 1,
                      name = "Depth Suitability") +
  geom_sf(data = geo, color = 'grey50',
          fill = NA) +
  geom_sf_text(data = geo_ms, aes(label = Reach),
                color = 'black',
                size = 2,
                nudge_x = -3000,
                nudge_y = -1000) +
  geom_sf_text(data = geo_nf, aes(label = Reach),
                color = 'black',
                size = 2,
                nudge_x = 50,
                nudge_y = 2000) +
  geom_sf_text(data = geo_sf, aes(label = Reach),
                color = 'black',
                size = 2,
                nudge_x = 50,
                nudge_y = -3000) +
  theme(axis.text = element_blank(),
        axis.title = element_blank(),
        axis.ticks = element_blank(),
        panel.grid = element_blank(),
      
        legend.position = "top") +
  facet_grid(year ~ scenario, labeller = labeller(scenario = scenario_labs))
depth_rkm
```

Figure \@ref(fig:vel-map-rkm) shows the habitat suitability by depth of each river kilometer by species, life stage, and year with the outlines of the geomorphic reaches in the Upper Walla Walla watershed. 

```{r vel-map-rkm, results = 'hide', fig.cap = "Map showing the velocity (depth avg) suitability by life stage and year for Chinook salmon and steelhead in the Upper Walla Walla River, plotted by river kilometer with geomorphic reaches also shown."}

# Velocity maps
# HHS maps
vel_rkm = merge(rkm, hhs, by = "Reach_ID") %>%
ggplot() +
geom_sf(aes(fill = v_HSI)) +
scale_fill_distiller(palette = "Spectral",
                      direction = 1,
                      name = "Velocity Suitability") +
  geom_sf(data = geo, color = 'grey50',
          fill = NA) +
  geom_sf_text(data = geo_ms, aes(label = Reach),
                color = 'black',
                size = 2,
                nudge_x = -3000,
                nudge_y = -1000) +
  geom_sf_text(data = geo_nf, aes(label = Reach),
                color = 'black',
                size = 2,
                nudge_x = 50,
                nudge_y = 2000) +
  geom_sf_text(data = geo_sf, aes(label = Reach),
                color = 'black',
                size = 2,
                nudge_x = 50,
                nudge_y = -3000) +
  theme(axis.text = element_blank(),
        axis.title = element_blank(),
        axis.ticks = element_blank(),
        panel.grid = element_blank(),
        legend.position = "top") +
  facet_grid(year ~ scenario,  labeller = labeller(scenario = scenario_labs))
vel_rkm

```


