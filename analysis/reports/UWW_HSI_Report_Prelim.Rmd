---
title: "Hydraulic Habitat Suitability Analysis, Upper Walla Walla Watershed"

author:
  - name: Tulley Mackey
    email: tulley.mackey@mthoodenvironmental.com
    institute: [mhe_salmon]
    correspondence: true
  - name: Mike Ackerman
    email: mike.ackerman@mthoodenvironmental.com
    institute: [mhe_mccall]
    correspondence: true
institute:
  - mhe_mccall: Mount Hood Environmental, PO Box 4282, McCall, Idaho, 83638, USA
  - mhe_salmon: Mount Hood Environmental, 1009 South Daisy Street, Salmon, ID 83467, USA
date: '`r format(Sys.Date(), "%B %d, %Y")`'
output:
  bookdown::html_document2:
    theme: yeti
    toc: yes
    toc_depth: 3
    toc_float:
      collapsed: yes
      smooth_scroll: yes
    number_sections: yes
    pandoc_args:
    - --lua-filter=../templates/scholarly-metadata.lua
    - --lua-filter=../templates/author-info-blocks.lua
    - --lua-filter=../templates/pagebreak.lua  
csl: "../templates/journal-of-archaeological-science.csl"
bibliography:
  - AckermanLibrary.bib
always_allow_html: yes
---

<!-- the following inserts MHE logo into header -->

```{=html}
<script>
   $(document).ready(function() {
     $head = $('#header');
     $head.prepend('<img src=\"logo.jpg\" style=\"float: right;width: 150px;\"/>')
   });
</script>
```
```{r setup, echo = FALSE, message = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  warning = FALSE,
  message = FALSE,
  echo = FALSE,
  comment = "#>",
  fig.path = "../figures/",
  dpi = 600
)

options(knitr.kable.NA = '--')

``` 

```{r load-library, echo = FALSE, message = FALSE, warning = FALSE, results = 'hide'}

# load knitr for markdown
library(knitr)
library(kableExtra)

# load packages for analysis
library(tidyverse)
library(here)
library(ggpubr)
library(sf)
library(readxl)
library(ggmap)
library(nngeo)
library(janitor)
library(readr)
library(gridExtra)
library(reshape2)
library(dplyr)
library(ggplot2)

theme_set(theme_pubr(x.text.angle = 45,
                     base_size = 8))
```

# Background

Water is the cornerstone of First Foods production and inherently tied to the five fundamental touchstones: hydrology, geomorphology, habitat and network connectivity, riverine biotic community, and riparian vegetation [@Jones2008]. These touchstones form the Umatilla River Vision, a holistic approach to water quality restoration. In support of the Vision, population status and habitat use of riverine fishes defined as First Foods (including Endangered Species Act [ESA] listed middle Columbia River summer-run steelhead, spring-run Chinook salmon, bull trout, and Pacific lamprey) have been identified as critical data needs in the assessment of biotic communities [@Jones2008]. 

In this document, we assess the hydraulic habitat suitability (HHS) in the upper Walla Walla watershed to support select life stages of spring-run Chinook salmon and summer-run steelhead. By comparing depth and velocity suitability curves for Chinook salmon and steelhead, developed by [@Maret2006], to continuous modeled depths and depth averaged velocities (supported by bathymetric Light Detection and Ranging; LiDAR) available for the upper Walla Walla watershed, we can further the understanding of how habitat, related specifically to hydraulics and the governing morphology, may be limiting recovery of Chinook salmon and steelhead. This information can help identify geomorphic reaches where existing depth and velocity may be limiting particular species and life stages, which could prove useful for prioritizing habitat rehabilitation. The incorporation of a hydraulic suitability analysis with habitat capacity (QRF), summer stream temperature, and morphological analyses allows for a robust assessment of the existing habitat conditions and limiting factors for target species and life stages.

## Objective

Evaluate the depth, velocity, and composite suitability of reaches in the North Fork (NF), South Fork (SF), and upper mainstem Walla Walla (MS) rivers based on modeled depth and depth averaged velocity rasters supported by multi-year LIDAR sampling events that encompass the study reaches. Composite suitability is the geometric mean of depth and velocity suitabilities. Suitability results are summarized both by river kilometers and geomorphic reaches. Hydraulic suitability is evaluated for both spring-run Chinook salmon (hereafter Chinook salmon) and Middle Columbia River summer-run steelhead (hereafter steelhead) at multiple life stages, including adult spawning and juvenile rearing for Chinook salmon and juvenile rearing for steelhead, at base flow discharge scenarios (see Table \@ref(tab:scenarios-tab)). Hydraulic models were available from LiDAR for both 2019 (pre-flood) and 2021 (post-flood), and thus, we evaluate hydraulic suitability for both years to consider changes in HHS resulting from extensive flooding in 2020.

## Focal Species

The focal species for the HHS analyses are:

-   Chinook salmon (*Oncorhynchus tshawytscha*)
-   steelhead (*O. mykiss*, ESA-listed "threatened")

While our HHS models specifically address Chinook salmon and steelhead, any uplift in habitat for these species are also expected to benefit:

-   Columbia River bull trout (*Salvelinus confluentus*; ESA-listed "threatened")
-   Pacific lamprey (*Lampetra tridentata*)

## Study Area

The spatial domain of this assessment is limited to the sections of the mainstem upper Walla Walla River, and the North and South forks where LiDAR data and hydraulic model results are available.  The downstream extent is defined by the mainstem's confluence with Dry Creek near Lowden, Washington, and upstream extents continue into the North and South forks, approximately 18.5 km (11.5 miles), and 33 km (20.5 miles), respectively. This assessment includes approximately 38.5 km (24 miles) of the mainstem Walla Walla River (Table \@ref(tab:rkm-geo-rch)).

# Methods

We provide methods for calculating the depth, velocity, and composite suitability, including for each pixel in a raster, for a single "model scenario". A given scenario includes a species by life stage combination and a year (2019 or 2021). Suitability results are then summarized both by river kilometer (rkm) and geomorphic reach. For reference, Table \@ref(tab:rkm-geo-rch) shows the minimum and maximum river kilometer for each geomorphic reach and watershed. Here, we provide detailed methods for Scenario 1 in Table \@ref(tab:scenarios-tab): Chinook salmon juvenile rearing in 2019. The same methods were then applied across all scenarios using the appropriate depth and velocity curves (depending on species and adult versus juvenile) or differing input depth and depth averaged velocity rasters (depending on year).Scenarios are summarized in Table \@ref(tab:scenarios-tab). Data, code, outputs, and reports for this analysis can be found in a GitHub repository at https://github.com/Mount-Hood-Environmental/UWW.plan.

Detailed methods are as follows:

1. Raster .tifs containing modeled depth and velocity values derived from 2019 LiDAR were imported into R [@RCoreTeam2021] with a raster pixel resolution of 1m x 1m. Rasters were provided by Rio Applied Science and Engineering (Rio ASE).

2. Import polygon shapefiles delineating river kilometers and geomorphic reaches. Shapefiles were used to "assign" each pixel to a river kilometer and geomorphic reach.

3. Read in the juvenile Chinook salmon rearing depth and velocity suitability curves from @Maret2006.  Functions to calculate the suitability for a given depth or velocity are available [here](https://github.com/Mount-Hood-Environmental/UWW.plan/analysis/scripts/hsi/hsi_curves.R). The [Habitat Suitability] section below shows the suitability curves used from @Maret2006.

4. Use the suitability curves to calculate the depth and velocity suitability for each raster pixel. The result is two new rasters each containing the calculated depth and velocity suitability indices for each pixel, respectively.

5. Calculate the composite suitability value for each raster pixel as the geometric mean of the depth and velocity suitability values. The result is a third composite suitability raster.

6. Extract the depth, velocity, and composite suitability values located within each rkm and geomorphic reach for each pixel into a data frame. The resulting data frame can be used to summarize and visualize the suitability results by rkm or geomorphic reach for the juvenile Chinook salmon rearing in 2019.

7. Store the depth, velocity, and composite suitability values, rkms and geomorphic reaches for each pixel. These results are currently stored in the [output/hsi_raw/](https://github.com/Mount-Hood-Environmental/analysis/hsi_outputs) directory in the [repo](https://github.com/Mount-Hood-Environmental/UWW.plan/).

8. Calculate the total wetted area, weighted usable area, and normalized weighted usable area (i.e., HHS) for juvenile Chinook salmon, in 2019, by rkm and geomorphic reach. The total wetted area was calculated by counting the total number of pixels (each with an area of 1m^2), that occur within each rkm and geomorphic reach. The weighted usable area (WUA) was calculated by summing the composite suitability values of all pixels within that same area. And finally, the normalized weighted usable area i.e., HHS, was calculated by dividing the WUA by the total wetted area for each rkm and geomorphic reach.

The process can then be repeated for each model "run" (Table \@ref(tab:scenarios-tab)). The resulting raster .tifs are also available in the GitHub repository at https://github.com/Mount-Hood-Environmental/UWW.plan. 

Finally, suitability values were summarized and visualized by year, species, and life stage (Chinook salmon adult spawning, Chinook salmon and steelhead juvenile rearing), and rkm / geomorphic reach. Box plots were used to show the distribution of depth, velocity, and composite suitability values and are provided in the [Results]. Maps showing the HHS, by rkm / geomorphic reach, are provided by species, life stage, and year, as well as plots showing the HHS for each scenario considered.

```{r rkm-geo-rch}
geo_order = c("GR_01_MS", 
              "GR_02_MS", 
              "GR_03_MS", 
              "GR_04_MS", 
              "GR_05_MS", 
              "GR_01_NF", 
              "GR_02_NF", 
              "GR_03_NF", 
              "GR_04_NF",
              "GR_05_NF", 
              "GR_01_SF", 
              "GR_02_SF", 
              "GR_03_SF", 
              "GR_04_SF", 
              "GR_05_SF")

geo_reach = read_csv(here("analysis/data/raw_data/reach_partitions/Geo_reaches_corrected.csv")) %>%
  rename(Watershed = Strm_Name,
         `Min rkm` = From_RKM,
         `Max rkm` = To_RKM,
         `Geomorphic Reach` = Reach_ID) %>%
  mutate(`Length (km)` = round(Shape_Leng / 1000, 1)) %>%
  select(`Geomorphic Reach`,
         Watershed,
         `Min rkm`,
         `Max rkm`,
         `Length (km)`) %>%
  mutate(`Geomorphic Reach` = factor(`Geomorphic Reach`, levels = geo_order)) %>%
  arrange(`Geomorphic Reach`) %>%
  kable(booktabs = T,
        align = "ccccc",
        caption = "The minimum and maximum river kilometer and length of each geomorphic reach. River kilometers increase moving upstream.") %>%
  kable_styling(full_width = F,
                position = "center",
                bootstrap_options = c("striped", "condensed"))
geo_reach

```

```{r scenarios-tab}
scenarios_tab = tibble(Scenario = c(1:6),
                       Species = c("Chinook salmon", "Chinook salmon", "Chinook salmon", "Chinook salmon", "Steelhead", "Steelhead"),
                       `Life Stage` = c("Juvenile", "Juvenile", "Spawning", "Spawning", "Juvenile", "Juvenile"),
                       Year = c("2019", "2021", "2019", "2021", "2019", "2021"),
                       `Depth Raster` = c("Combined_2019lidar_LowFlow_Depth_metric.tif",
                                          "Combined_2021lidar_LowFlow_Depth_metric.tif",
                                          "Combined_2019lidar_LowFlow_Depth_metric.tif",
                                          "Combined_2021lidar_LowFlow_Depth_metric.tif",
                                          "Combined_2019lidar_LowFlow_Depth_metric.tif",
                                          "Combined_2021lidar_LowFlow_Depth_metric.tif"),
                       `Velocity Raster` = c("Combined_2019lidar_LowFlow_Velocity_metric.tif",
                                             "Combined_2021lidar_LowFlow_Velocity_metric.tif",
                                             "Combined_2019lidar_LowFlow_Velocity_metric.tif",
                                             "Combined_2021lidar_LowFlow_Velocity_metric.tif",
                                             "Combined_2019lidar_LowFlow_Velocity_metric.tif",
                                             "Combined_2021lidar_LowFlow_Velocity_metric.tif")) %>%
  kable(booktabs = T,
        align = "cccccc",
        caption = "Model scenarios for which we evaluated depth, velocity, and composite suitabilites including the corresponding depth and velocity rasters used for each scenario.") %>%
  kable_styling(full_width = F,
                position = "center",
                bootstrap_options = c("striped", "condensed"))
scenarios_tab

```

## Suitability Curves

```{r hsi-curves}
hsi_df = read_csv(here("analysis/data/raw_data/maret_hsi_curves_for_r_uww.csv"))

```

Depth and velocity suitability curves for Chinook salmon and steelhead were derived from @Maret2006 (Figures \@ref(fig:chnk-hsi) and \@ref(fig:sthd-hsi)). These curves were used to calculate the depth or velocity suitability for each pixel within a given scenario. As an example, using juvenile Chinook salmon and depth, if a pixel has a depth of 0 m, that pixel is assigned a suitability of 0 whereas if the depth is greater than approximately 0.6 m it is assigned a suitability of 1. A depth of 0.5 m would be assigned a suitability of $\sim$ 0.7. The composite suitability for a pixel is then calculated as the geometric mean of the depth and velocity suitability values.

```{r chnk-hsi, fig.height = 4, fig.cap = "Suitability indices at varying depths and velocities for juvenile rearing and adult spawning for Chinook salmon from Maret et al. (2006)."}
# chinook hsi curves
chnk_hsi = hsi_df %>%
  filter(species == "Chinook") %>%
  ggplot(aes(x = value_m, y = si)) +
  geom_line(color = "royalblue3", size = 1.5) +
  coord_cartesian(xlim = c(0,2)) +
  theme_bw() +
  facet_grid(variable ~ life_stage) +
  labs(x = "Value (m | m/s)",
       y = "Suitability Index",
       title = "Chinook salmon")
chnk_hsi

```

```{r sthd-hsi, fig.height = 4, fig.cap = "Suitability indices at varying depths and velocities for juvenile rearing for steelhead from Maret et al. (2006)."}
sthd_hsi = hsi_df %>%
  filter(species == "Steelhead") %>%
  ggplot(aes(x = value_m, y = si)) +
  geom_line(color = "royalblue3", size = 1.5) +
  coord_cartesian(xlim = c(0,2)) +
  theme_bw() +
  facet_grid( life_stage ~ variable) +
  labs(x = "Value (m | m/s)",
       y = "Suitability Index",
       title = "Steelhead")
sthd_hsi

```


# Results

```{r raw-results}
# read raw hsi results files for each species/life stage and year and merge into one df
hsi_raw = list.files("S:/main/data/habitat/HSI/UWW_hsi_results/raw_results", pattern = "*.rda", full.names = T) %>%
  map_df(~read_rds(.)) %>%
  as_tibble() %>%
  mutate(watershed = case_when(
    grepl("MS", ID) ~ "Mainstem",
    grepl("NF", ID) ~ "North Fork",
    grepl("SF", ID) ~ "South Fork"
  ))

```

```{r hhs-results, results = 'hide'}
rkm = st_read(here("analysis/data/derived_data/hsi/rkm_poly.shp")) %>%
  select(Reach_ID, Strm_Name, geometry) %>%
  rename(watershed = Strm_Name)

geo = st_read(here("analysis/data/derived_data/hsi/geom_buffer.shp")) %>%
  select(Reach, geometry)

geo_ms = geo %>%
  filter(str_starts(Reach, "MS"))
geo_nf = geo %>%
  filter(str_starts(Reach, "NF"))
geo_sf = geo %>%
  filter(str_starts(Reach, "SF"))

hhs_rkm = list.files(here("analysis/hsi_outputs/csvs/"), pattern = "*.csv", full.names = T) %>%
  map_df(~ read_csv(.)) %>%
  rename(Reach_ID = ID) %>%
  filter(str_starts(Reach_ID, "RKM"))

hhs_geo = list.files(here("analysis/hsi_outputs/csvs/"), pattern = "*.csv", full.names = T) %>%
  map_df(~ read_csv(.)) %>%
  rename(Reach_ID = ID) %>%
  filter(str_starts(Reach_ID, "GR"))

```

Here, we summarize the distribution of depth, velocity, and composite suitability values by geomorphic reaches across the mainstem, North Fork and South Fork watersheds.  We also summarize average suitability (depth, velocity, and composite) by river kilometer. Results are provided for Chinook salmon spawning and Chinook salmon and steelhead juvenile rearing, focusing primarily on results from 2021 to describe the suitability of recent depths and velocities; however, results for 2019 are provided in the [Supplemental Tables and Figures] to understand hydraulic conditions prior extensive flooding in 2020 and draw comparison to current conditions.

## Chinook Salmon Spawning

The composite hydraulic suitability for spawning is highly variable across the three watersheds, with the South Fork being most suitable (Figure \@ref(fig:uww-chnk-spw-plot)).  The mainstem Walla Walla River exhibits the greatest intravariability, where geomorphic reaches four and five are highly suitable, reaches one and two are unsuitable, and reach three falls in between. Depth appears to be the limiting factor for the mainstem and South Fork watersheds, and both depth and velocity limit spawning suitability in the North Fork. Comparing average composite suitability by river kilometer from 2019 to 2021, it appears very little change resulted from flooding in 2020 (Figure \@ref(fig:chnk-spw-hhs)).      

```{r uww-chnk-spw-plot, fig.height = 7, fig.cap = "Box plots showing the distribution of suitability values for composite, depth and velocity for **Chinook salmon spawning** across geomorphic reaches in the Upper Walla Walla watershed in 2021."}
# Chinook salmon spawning, 2021
chnk_spw_2021_geo = hsi_raw %>%
  filter(year == "2021",
         scenario == "chnk_spw",
         str_starts(ID, "GR")) %>%
  mutate(ID = factor(ID, levels = geo_order)) %>%
  ggplot(aes(x = ID, 
             y = value, 
             fill = watershed)) +
  geom_boxplot() +
  facet_wrap(~ metric, nrow = 3) +
  theme_classic() +
  labs(x = "Geomorphic Reach",
       y = "Suitability Index") +
  theme(plot.title = element_text(hjust = 0.5), legend.position = "top",
        axis.text.x = element_text(angle = 45, vjust = 0.5),
        axis.title.x = element_text(margin = margin(t = 10)),
        axis.title.y = element_text(margin = margin(r = 10)))
chnk_spw_2021_geo
#ggsave("../output/figures/ul_cs_plot.pdf", ul_p)

```

```{r chnk-spw-map, fig.height = 7, results = 'hide', fig.cap = "Map showing the hydraulic habitat suitability for **Chinook salmon spawning** in the Upper Walla Walla watershed for 2021, plotted by river kilometer with geomorphic reaches shown."}
# Chinook spawning map
chnk_spw_map = merge(rkm, hhs_rkm, by = "Reach_ID") %>%
  filter(scenario == "chnk_spw", year == "2021") %>%
  select(Reach_ID,
         year,
         Composite = HHS,
         Depth = d_HSI,
         Velocity = v_HSI) %>%
  pivot_longer(cols = c("Composite", 
                        "Depth", 
                        "Velocity"),
               names_to = "suitability",
               values_to = "value") %>%
  mutate(suitability = factor(suitability, levels = c("Composite",
                                                      "Depth",
                                                      "Velocity"))) %>%
  ggplot() +
  geom_sf(aes(fill = value),
          colour = NA) +
  scale_fill_distiller(palette = "Spectral",
                       direction = 1,
                       name = "Suitability Index") +
  geom_sf(data = geo,
          color = "grey50",
          fill = NA) +
  geom_sf_text(data = geo_ms,
               aes(label = Reach),
               color = "black",
               size = 2,
               nudge_x = -4000,
               nudge_y = -1000) +
  geom_sf_text(data = geo_nf, aes(label = Reach),
               color = 'black',
               size = 2,
               nudge_x = 50,
               nudge_y = 2000) +
  geom_sf_text(data = geo_sf, aes(label = Reach),
               color = 'black',
               size = 2,
               nudge_x = 50,
               nudge_y = -3000) +
  theme_classic() +
  theme(axis.text = element_blank(),
        axis.text.x = element_blank(),
        axis.title = element_blank(),
        axis.ticks = element_blank(),
        panel.grid = element_blank(),
        legend.position = "left") +
 facet_wrap(~ suitability, nrow = 3)
chnk_spw_map  

```

```{r chnk-spw-hhs, fig.height = 3, fig.cap = "Hydraulic habitat suitability (composite) by river kilometer for **Chinook salmon spawning** for 2019 and 2021."}
chnk_spw_hhs_p = hhs_rkm %>%
  filter(scenario == "chnk_spw") %>%
  select(scenario,
         year,
         Reach_ID,
         HHS) %>%
  mutate(watershed = case_when(
    grepl("MS", Reach_ID) ~ "Mainstem",
    grepl("NF", Reach_ID) ~ "North Fork",
    grepl("SF", Reach_ID) ~ "South Fork"
  )) %>%
  mutate(rkm = as.numeric(substr(Reach_ID, 5, 6)),
         year = as.factor(year)) %>%
  ggplot(aes(x = rkm)) +
  # geom_line(aes(y = HHS), color = "royalblue4", size = 0.5) +
  # geom_smooth(aes(y = HHS), color = "royalblue4", se = F, size = 1.1) +
  geom_line(aes(y = HHS, color = year), size = 0.5) +
  geom_smooth(aes(y = HHS, color = year), se = F, size = 1.1) +
  ylim(0,1) +
  facet_wrap(~ watershed, scales = "free_x") +
  labs(x = "River Kilometer",
       y = "Hydraulic Suitability",
       color = "Year") +
  theme_classic() +
  theme(legend.position = "top")
chnk_spw_hhs_p

```

## Chinook Salmon Juvenile Rearing

Comparatively across species, life stages, and watersheds, composite hydraulic suitability is lowest for Chinook juvenile rearing (Figure \@ref(fig:uww-chnk-juv-plot)). Depth is a limiting factor for Chinook rearing suitability in all three watersheds, with velocities being mostly suitable in the mainstem and North Fork, and unsuitable in the South Fork. Similar to spawning, average hydraulic suitability by river kilometer for Chinook rearing changed little from 2019 to 2021 (Figure \@ref(fig:chnk-juv-hhs)).  

```{r uww-chnk-juv-plot, fig.height = 7, fig.cap = "Box plots showing the distribution of suitability values for composite, depth and velocity for **Chinook salmon juvenile rearing** across geomorphic reaches in the Upper Walla Walla watershed in 2021."}
# Chinook juvenile rearing, 2021
chnk_juv_2021_geo = hsi_raw %>%
  filter(year == "2021",
         scenario == "chnk_juv",
         str_starts(ID, "GR")) %>%
  mutate(ID = factor(ID, levels = geo_order)) %>%
  ggplot(aes(x = ID,
             y = value,
             fill = watershed)) +
  geom_boxplot() +
  facet_wrap(~ metric, nrow = 3) +
  theme_classic() +
  labs(x = "Geomorphic Reach",
       y = "Suitability Index") +
  theme(plot.title = element_text(hjust = 0.5), legend.position = "top",
        axis.text.x = element_text(angle = 45, vjust = 0.5),
        axis.title.x = element_text(margin = margin(t = 10)),
        axis.title.y = element_text(margin = margin(r = 10)))
chnk_juv_2021_geo

```

```{r chnk-juv-map, results = 'hide', fig.height = 7, fig.cap = "Map showing the hydraulic habitat suitability for **Chinook salmon juvenile rearing** in the Upper Walla Walla watershed for 2019 and 2021, plotted by river kilometer with geomorphic reaches shown."}
# Chinook juvenile rearing map
chnk_juv_map = merge(rkm, hhs_rkm, by = "Reach_ID") %>%
  filter(scenario == "chnk_juv", year == "2021") %>%
  select(Reach_ID,
         year,
         Composite = HHS,
         Depth = d_HSI,
         Velocity = v_HSI) %>%
  pivot_longer(cols = c("Composite", 
                        "Depth", 
                        "Velocity"),
               names_to = "suitability",
               values_to = "value") %>%
  mutate(suitability = factor(suitability, levels = c("Composite",
                                                      "Depth",
                                                      "Velocity"))) %>% 
  ggplot() +
  geom_sf(aes(fill = value),
          colour = NA) +
  scale_fill_distiller(palette = "Spectral",
                       direction = 1,
                       name = "Suitability Index") +
  geom_sf(data = geo,
          color = "grey50",
          fill = NA) +
  geom_sf_text(data = geo_ms,
               aes(label = Reach),
               color = "black",
               size = 2,
               nudge_x = -4000,
               nudge_y = -1000) +
  geom_sf_text(data = geo_nf, aes(label = Reach),
               color = 'black',
               size = 2,
               nudge_x = 50,
               nudge_y = 2000) +
  geom_sf_text(data = geo_sf, aes(label = Reach),
               color = 'black',
               size = 2,
               nudge_x = 50,
               nudge_y = -3000) +
  theme_classic() +
  theme(axis.text = element_blank(),
        axis.text.x = element_blank(),
        axis.title = element_blank(),
        axis.ticks = element_blank(),
        panel.grid = element_blank(),
        legend.position = "left") +
  facet_wrap(~ suitability, nrow = 3)
chnk_juv_map  

```

```{r chnk-juv-hhs, fig.height = 3, fig.cap = "Hydraulic habitat suitability (composite) by river kilometer for **Chinook salmon juvenile rearing** for 2019 and 2021."}
chnk_juv_hhs_p = hhs_rkm %>%
  filter(scenario == "chnk_juv") %>%
  select(scenario,
         year,
         Reach_ID,
         HHS) %>%
  mutate(watershed = case_when(
    grepl("MS", Reach_ID) ~ "Mainstem",
    grepl("NF", Reach_ID) ~ "North Fork",
    grepl("SF", Reach_ID) ~ "South Fork"
  )) %>%
  mutate(rkm = as.numeric(substr(Reach_ID, 5, 6)),
         year = as.factor(year)) %>%
  ggplot(aes(x = rkm)) +
  geom_line(aes(y = HHS, color = year), size = 0.5) +
  geom_smooth(aes(y = HHS, color = year), se = F, size = 1.1) +
  ylim(0,1) +
  facet_wrap(~ watershed, scales = "free_x") +
  labs(x = "River Kilometer",
       y = "Hydraulic Suitability",
       color = "Year") +
  theme_classic() +
  theme(legend.position = "top")
chnk_juv_hhs_p

```


## Steelhead Juvenile Rearing

Composite suitability for steelhead juvenile rearing is moderate to high in both the mainstem and South Fork watersheds (Figure \@ref(fig:uww-sthd-juv-plot)). Hydraulic conditions are less suitable in the North Fork, limited by depth. The distribution of velocities across all three watersheds are consistently very suitable. Again, there is very little difference in the average suitability by river kilometer from 2019 to 2021 for steelhead juvenile rearing (Figure \@ref(fig:sthd-juv-hhs)). 

```{r uww-sthd-juv-plot, fig.height = 7, fig.cap = "Box plots showing the distribution of suitability values for composite, depth and velocity for **steelhead juvenile rearing** across geomorphic reaches in the Upper Walla Walla watershed in 2021."}
# steelhead juvenile rearing, 2021
sthd_juv_2021_geo = hsi_raw %>%
  filter(year == "2021",
         scenario == "sthd_juv",
         str_starts(ID, "GR")) %>%
  mutate(ID = factor(ID, levels = geo_order)) %>%
  ggplot(aes(x = ID, 
             y = value, 
             fill = watershed)) +
  geom_boxplot() +
  facet_wrap(~ metric, nrow = 3) +
  theme_classic() +
  labs(x = "Geomorphic Reach",
       y = "Suitability Index") +
  theme(plot.title = element_text(hjust = 0.5), legend.position = "top",
        axis.text.x = element_text(angle = 45, vjust = 0.5),
        axis.title.x = element_text(margin = margin(t = 10)),
        axis.title.y = element_text(margin = margin(r = 10)))
sthd_juv_2021_geo

```

```{r steelhead-juv-map, results = 'hide', fig.height = 7, fig.cap = "Map showing the hydraulic habitat suitability for **steelhead juvenile rearing** in the Upper Walla Walla watershed for 2019 and 2021, plotted by river kilometer with geomorphic reaches shown."}
# steelhead juvenile rearing map
sthd_juv_map = merge(rkm, hhs_rkm, by = "Reach_ID") %>%
  filter(scenario == "sthd_juv", year == "2021") %>%
  select(Reach_ID,
         year,
         Composite = HHS,
         Depth = d_HSI,
         Velocity = v_HSI) %>%
  pivot_longer(cols = c("Composite", 
                        "Depth", 
                        "Velocity"),
               names_to = "suitability",
               values_to = "value") %>%
  mutate(suitability = factor(suitability, levels = c("Composite",
                                                      "Depth",
                                                      "Velocity"))) %>%
  ggplot() +
  geom_sf(aes(fill = value),
          colour = NA) +
  scale_fill_distiller(palette = "Spectral",
                       direction = 1,
                       name = "Suitability Index") +
  geom_sf(data = geo,
          color = "grey50",
          fill = NA) +
  geom_sf_text(data = geo_ms,
               aes(label = Reach),
               color = "black",
               size = 2,
               nudge_x = -4000,
               nudge_y = -1000) +
  geom_sf_text(data = geo_nf, aes(label = Reach),
               color = 'black',
               size = 2,
               nudge_x = 50,
               nudge_y = 2000) +
  geom_sf_text(data = geo_sf, aes(label = Reach),
               color = 'black',
               size = 2,
               nudge_x = 50,
               nudge_y = -3000) +
  theme_classic() +
  theme(axis.text = element_blank(),
        axis.text.x = element_blank(),
        axis.title = element_blank(),
        axis.ticks = element_blank(),
        panel.grid = element_blank(),
        legend.position = "left") +
  facet_wrap(~ suitability, nrow = 3)
sthd_juv_map  

```

```{r sthd-juv-hhs, fig.height = 3, fig.cap = "Hydraulic habitat suitability (composite) by river kilometer for **steelhead juvenile rearing** for 2019 and 2021."}
sthd_juv_hhs_p = hhs_rkm %>%
  filter(scenario == "sthd_juv") %>%
  select(scenario,
         year,
         Reach_ID,
         HHS) %>%
  mutate(watershed = case_when(
    grepl("MS", Reach_ID) ~ "Mainstem",
    grepl("NF", Reach_ID) ~ "North Fork",
    grepl("SF", Reach_ID) ~ "South Fork"
  )) %>%
  mutate(rkm = as.numeric(substr(Reach_ID, 5, 6)),
         year = as.factor(year)) %>%
  ggplot(aes(x = rkm)) +
  geom_line(aes(y = HHS, color = year), size = 0.5) +
  geom_smooth(aes(y = HHS, color = year), se = F, size = 1.1) +
  ylim(0,1) +
  facet_wrap(~ watershed, scales = "free_x") +
  labs(x = "River Kilometer",
       y = "Hydraulic Suitability",
       color = "Year") +
  theme_classic() +
  theme(legend.position = "top")
sthd_juv_hhs_p

```

# Discussion

Overall, current composite hydraulic suitability in the upper Walla Walla River watershed is most suitable for steelhead juvenile rearing and least suitable for Chinook juvenile rearing.  Suitable habitat for steelhead juveniles includes slightly shallower depths and higher velocities when compared to Chinook juveniles.  A lack of habitat with depths greater than 0.25 meters at low flows limits Chinook rearing in the upper Walla Walla watershed, with velocities contributing to unsuitable conditions in the South Fork.  Chinook spawning composite suitability is more variable, with suitable spawning conditions in the South Fork, unsuitable conditions in the North Fork and a wide distribution across reaches in the mainstem. Depth is limiting for all three species/life stages in the North Fork, but, interestingly, North Fork velocities appear to be suitable for Chinook rearing. This is counter-intuitive because shallower habitat is typically associated with higher velocities found in riffles and rapids.

## Other Focal Species

Based on habitat preference research in eastern Oregon conducted by Al-Chokachy and Budy (2007), bull trout prefer deep, slow-water habitat, aligning closest with Chinook juvenile suitability curves used in this analysis. As discussed above, of the three species/life stages analyzed, composite hydraulic suitability is most limiting for Chinook juvenile rearing collectively, indicating that similar limitations for bull trout in the upper Walla Walla watershed exist. A literature review on Pacific Lamprey habitat preferences did not yield any hydraulic suitability information, prohibiting further discussion on the species.

## Model Limitations

While this HHS analysis provide insight on hydraulic limitations for Chinook salmon spawning and rearing, and steelhead rearing, it should be viewed in the context of fish habitat preferences holistically. It is generally accepted that high quality salmonid habitat is comprised of multiple habitat characteristics in addition to depth and velocity, including cover, water temperature and food availability. Because of this, we encourage the integration of the information summarized here with the other biological and geomorphological assessments provided for the upper Walla Walla watershed to inform rehabilitation efforts.    

# Literature Cited

<!-- The following line ensures the references appear here for the MS Word or HTML output files, rather than right at the end of the document (this will not work for PDF files):  -->

::: {#refs}
:::

# Supplemental Tables and Figures

```{r chnk-spw-box-p, fig.cap = "Box plots showing the distribution of suitability values for composite, depth and velocity for **Chinook salmon spawning** across geomorphic reaches in the Upper Walla Walla watershed, 2019 and 2021."}
chnk_spw_box_p = hsi_raw %>%
  filter(scenario == "chnk_spw",
         str_starts(ID, "GR")) %>%
  mutate(ID = factor(ID, levels = geo_order)) %>%
  ggplot(aes(x = ID, 
             y = value, 
             fill = watershed)) +
  geom_boxplot() +
  facet_grid(metric ~ year) +
  theme_bw() +
  labs(x = "Geomorphic Reach",
       y = "Suitability Index") +
  theme(plot.title = element_text(hjust = 0.5), 
        legend.position = "top",
        axis.text.x = element_text(angle = 45, vjust = 0.5),
        axis.title.x = element_text(margin = margin(t = 10)),
        axis.title.y = element_text(margin = margin(r = 10)))
chnk_spw_box_p  

```

```{r chnk-juv-box-p, fig.cap = "Box plots showing the distribution of suitability values for composite, depth and velocity for **Chinook salmon juvenile rearing** across geomorphic reaches in the Upper Walla Walla watershed, 2019 and 2021."}
chnk_juv_box_p = hsi_raw %>%
  filter(scenario == "chnk_juv",
         str_starts(ID, "GR")) %>%
  mutate(ID = factor(ID, levels = geo_order)) %>%
  ggplot(aes(x = ID, 
             y = value, 
             fill = watershed)) +
  geom_boxplot() +
  facet_grid(metric ~ year) +
  theme_bw() +
  labs(x = "Geomorphic Reach",
       y = "Suitability Index") +
  theme(plot.title = element_text(hjust = 0.5), 
        legend.position = "top",
        axis.text.x = element_text(angle = 45, vjust = 0.5),
        axis.title.x = element_text(margin = margin(t = 10)),
        axis.title.y = element_text(margin = margin(r = 10)))
chnk_juv_box_p  

```

```{r sthd-juv-box-p, fig.cap = "Box plots showing the distribution of suitability values for composite, depth and velocity for **steelhead juvenile rearing** across geomorphic reaches in the Upper Walla Walla watershed, 2019 and 2021."}
sthd_juv_box_p = hsi_raw %>%
  filter(scenario == "sthd_juv",
         str_starts(ID, "GR")) %>%
  mutate(ID = factor(ID, levels = geo_order)) %>%
  ggplot(aes(x = ID, 
             y = value, 
             fill = watershed)) +
  geom_boxplot() +
  facet_grid(metric ~ year) +
  theme_bw() +
  labs(x = "Geomorphic Reach",
       y = "Suitability Index") +
  theme(plot.title = element_text(hjust = 0.5), 
        legend.position = "top",
        axis.text.x = element_text(angle = 45, vjust = 0.5),
        axis.title.x = element_text(margin = margin(t = 10)),
        axis.title.y = element_text(margin = margin(r = 10)))
sthd_juv_box_p  

```

```{r hhs-map-rkm, eval = F, results = 'hide', fig.cap = "Map showing the hydraulic habitat suitability by life stage and year for Chinook salmon and steelhead in the Upper Walla Walla watershed, plotted by river kilometer with geomorphic reaches also shown."}
# HHS map by scenario
scenario_labs = c("Chinook Juvenile", "Chinook Spawning", "Steelhead Juvenile")
names(scenario_labs) = c("chnk_juv", "chnk_spw", "sthd_juv")

# HHS maps
hhs_rkm = merge(rkm, hhs_rkm, by = "Reach_ID") %>%
ggplot() +
geom_sf(aes(fill = HHS)) +
scale_fill_distiller(palette = "Spectral",
                      direction = 1,
                      name = "Hydraulic Habitat Suitability (HHS)") +
  geom_sf(data = geo, color = 'grey50',
          fill = NA) +
  geom_sf_text(data = geo_ms, aes(label = Reach),
                color = 'black',
                size = 2,
                nudge_x = -4000,
                nudge_y = -1000) +
  geom_sf_text(data = geo_nf, aes(label = Reach),
                color = 'black',
                size = 2,
                nudge_x = 50,
                nudge_y = 2000) +
  geom_sf_text(data = geo_sf, aes(label = Reach),
                color = 'black',
                size = 2,
                nudge_x = 50,
                nudge_y = -3000) +
  theme(axis.text = element_blank(),
        axis.text.x = element_blank(),
        axis.title = element_blank(),
        axis.ticks = element_blank(),
        panel.grid = element_blank(),
        legend.position = "top") +
  facet_grid(year ~ scenario, labeller = labeller(scenario = scenario_labs))
hhs_rkm

```

```{r depth-map-rkm, eval = F, results = 'hide', fig.cap = "Map showing the depth suitability by life stage and year for Chinook salmon and steelhead in the Upper Walla Walla River, plotted by river kilometer with geomorphic reaches also shown."}
# Depth maps
depth_rkm = merge(rkm, hhs_rkm, by = "Reach_ID") %>%
ggplot() +
geom_sf(aes(fill = d_HSI)) +
scale_fill_distiller(palette = "Spectral",
                      direction = 1,
                      name = "Depth Suitability") +
  geom_sf(data = geo, color = 'grey50',
          fill = NA) +
  geom_sf_text(data = geo_ms, aes(label = Reach),
                color = 'black',
                size = 2,
                nudge_x = -3000,
                nudge_y = -1000) +
  geom_sf_text(data = geo_nf, aes(label = Reach),
                color = 'black',
                size = 2,
                nudge_x = 50,
                nudge_y = 2000) +
  geom_sf_text(data = geo_sf, aes(label = Reach),
                color = 'black',
                size = 2,
                nudge_x = 50,
                nudge_y = -3000) +
  theme(axis.text = element_blank(),
        axis.text.x = element_blank(),
        axis.title = element_blank(),
        axis.ticks = element_blank(),
        panel.grid = element_blank(),
        legend.position = "top") +
  facet_grid(year ~ scenario, labeller = labeller(scenario = scenario_labs))
depth_rkm

```

```{r vel-map-rkm, eval = F, results = 'hide', fig.cap = "Map showing the velocity (depth avg) suitability by life stage and year for Chinook salmon and steelhead in the Upper Walla Walla River, plotted by river kilometer with geomorphic reaches also shown."}
# Velocity maps
vel_rkm = merge(rkm, hhs_rkm, by = "Reach_ID") %>%
ggplot() +
geom_sf(aes(fill = v_HSI)) +
scale_fill_distiller(palette = "Spectral",
                      direction = 1,
                      name = "Velocity Suitability") +
  geom_sf(data = geo, color = 'grey50',
          fill = NA) +
  geom_sf_text(data = geo_ms, aes(label = Reach),
                color = 'black',
                size = 2,
                nudge_x = -3000,
                nudge_y = -1000) +
  geom_sf_text(data = geo_nf, aes(label = Reach),
                color = 'black',
                size = 2,
                nudge_x = 50,
                nudge_y = 2000) +
  geom_sf_text(data = geo_sf, aes(label = Reach),
                color = 'black',
                size = 2,
                nudge_x = 50,
                nudge_y = -3000) +
  theme(axis.text = element_blank(),
        axis.text.x = element_blank(),
        axis.title = element_blank(),
        axis.ticks = element_blank(),
        panel.grid = element_blank(),
        legend.position = "top") +
  facet_grid(year ~ scenario,  labeller = labeller(scenario = scenario_labs))
vel_rkm

```

```{r hhs-table}
hhs_tbl = hhs_geo %>%
  mutate(Watershed = case_when(
    grepl("MS", Reach_ID) ~ "Mainstem",
    grepl("NF", Reach_ID) ~ "North Fork",
    grepl("SF", Reach_ID) ~ "South Fork"
  )) %>%
  select(
    Scenario = scenario,
    Watershed,
    Reach = Reach_ID,
    Year = year,
    `Area m2` = area_m2,
    WUA,
    HHS,
    `Depth Suitability` = d_HSI,
    `Velocity Suitability` = v_HSI
  ) %>%
  mutate(
    WUA = round(WUA, 0),
    HHS = round(HHS, 2),
    `Depth Suitability` = round(`Depth Suitability`, 2),
    `Velocity Suitability` = round(`Velocity Suitability`, 2)
  ) %>%
  mutate(Scenario = recode(Scenario,
                           "chnk_spw" = "Chinook Spawning",
                           "chnk_juv" = "Chinook Juvenile",
                           "sthd_juv" = "Steelhead Juvenile")) %>%
  arrange(Scenario,
          Watershed,
          Reach) %>%
  kable(booktabs = T,
        align = "lcccccccc",
        caption = "Composite (HHS), depth, and velocity suitability values, area, and weighted usable area (WUA) by scenario, geomorphic reach, and year in the Upper Walla Walla watershed.") %>%
  kable_styling(full_width = F,
                position = "center",
                bootstrap_options = c("striped", "condensed"))
hhs_tbl

```

```{r chnk-spw-box-rkm-ms, eval = F, results = 'hide', fig.cap = "Box plots showing the distribution of suitability values for composite, depth and velocity for **Chinook salmon spawning** across river kilometers in the mainstem Upper Walla Walla River, 2021."}

# Box-plot by rkm, Chinook spawning, mainstem
chnk_spw_2021_rkm_ms = hsi_raw %>%
  filter(year == "2021",
         scenario == "chnk_spw",
         str_starts(ID, "RKM"),
         str_ends(ID, "MS")) %>%
  ggplot(aes(x = ID, 
             y = value, 
             fill = metric)) +
  geom_boxplot() +
  facet_wrap(~ metric, nrow = 3) +
  theme_classic() +
  labs(x = "River Kilometer",
       y = "Suitability Index") +
  theme(plot.title = element_text(hjust = 0.5), legend.position = "top",
        axis.text.x = element_text(angle = 45, vjust = 0.5),
        axis.title.x = element_text(margin = margin(t = 10)),
        axis.title.y = element_text(margin = margin(r = 10)))
chnk_spw_2021_rkm_ms

```

```{r chnk-spw-box-rkm-nf, eval = F, results = 'hide', fig.cap = "Box plots showing the distribution of suitability values for composite, depth and velocity for **Chinook salmon spawning** across river kilometers in the North Fork Walla Walla River, 2021."}

# Box-plot by rkm, Chinook spawning, North Fork
chnk_juv_2021_rkm_nf = hsi_raw %>%
  filter(year == "2021",
         scenario == "chnk_spw",
         str_starts(ID, "RKM"),
         str_ends(ID, "NF")) %>%
  ggplot(aes(x = ID, 
             y = value, 
             fill = metric)) +
  geom_boxplot() +
  facet_wrap(~ metric, nrow = 3) +
  theme_classic() +
  labs(x = "River Kilometer",
       y = "Suitability Index") +
  theme(plot.title = element_text(hjust = 0.5), legend.position = "top",
        axis.text.x = element_text(angle = 45, vjust = 0.5),
        axis.title.x = element_text(margin = margin(t = 10)),
        axis.title.y = element_text(margin = margin(r = 10)))
chnk_spw_2021_rkm_nf
```

```{r chnk-spw-box-rkm-sf, eval = F, results = 'hide', fig.cap = "Box plots showing the distribution of suitability values for composite, depth and velocity for **Chinook salmon spawning** across river kilometers in the South Fork Walla Walla River, 2021."}

# Box-plot by rkm, Chinook spawning, South Fork
chnk_juv_2021_rkm_sf = hsi_raw %>%
  filter(year == "2021",
         scenario == "chnk_spw",
         str_starts(ID, "RKM"),
         str_ends(ID, "SF")) %>%
  ggplot(aes(x = ID, 
             y = value, 
             fill = metric)) +
  geom_boxplot() +
  facet_wrap(~ metric, nrow = 3) +
  theme_classic() +
  labs(x = "River Kilometer",
       y = "Suitability Index") +
  theme(plot.title = element_text(hjust = 0.5), legend.position = "top",
        axis.text.x = element_text(angle = 45, vjust = 0.5),
        axis.title.x = element_text(margin = margin(t = 10)),
        axis.title.y = element_text(margin = margin(r = 10)))
chnk_spw_2021_rkm_sf
```

```{r chnk-juv-box-rkm-ms, eval = F, results = 'hide', fig.cap = "Box plots showing the distribution of suitability values for composite, depth and velocity for **Chinook salmon juvenile rearing** across river kilometers in the mainstem Upper Walla Walla River, 2021."}

# Box-plot by rkm, Chinook juvenile rearing, Mainstem
chnk_juv_2021_rkm_ms = hsi_raw %>%
  filter(year == "2021",
         scenario == "chnk_juv",
         str_starts(ID, "RKM"),
         str_ends(ID, "MS")) %>%
  ggplot(aes(x = ID, 
             y = value, 
             fill = metric)) +
  geom_boxplot() +
  facet_wrap(~ metric, nrow = 3) +
  theme_classic() +
  labs(x = "River Kilometer",
       y = "Suitability Index") +
  theme(plot.title = element_text(hjust = 0.5), legend.position = "top",
        axis.text.x = element_text(angle = 45, vjust = 0.5),
        axis.title.x = element_text(margin = margin(t = 10)),
        axis.title.y = element_text(margin = margin(r = 10)))
chnk_juv_2021_rkm_ms
```

```{r chnk-juv-box-rkm-nf, eval = F, results = 'hide', fig.cap = "Box plots showing the distribution of suitability values for composite, depth and velocity for **Chinook salmon juvenile rearing** across river kilometers in the North Fork Walla Walla River, 2021."}

# Box-plot by rkm, Chinook spawning, North Fork
chnk_juv_2021_rkm_nf = hsi_raw %>%
  filter(year == "2021",
         scenario == "chnk_juv",
         str_starts(ID, "RKM"),
         str_ends(ID, "NF")) %>%
  ggplot(aes(x = ID, 
             y = value, 
             fill = metric)) +
  geom_boxplot() +
  facet_wrap(~ metric, nrow = 3) +
  theme_classic() +
  labs(x = "River Kilometer",
       y = "Suitability Index") +
  theme(plot.title = element_text(hjust = 0.5), legend.position = "top",
        axis.text.x = element_text(angle = 45, vjust = 0.5),
        axis.title.x = element_text(margin = margin(t = 10)),
        axis.title.y = element_text(margin = margin(r = 10)))
chnk_juv_2021_rkm_nf
```

```{r chnk-juv-box-rkm-sf, eval = F, results = 'hide', fig.cap = "Box plots showing the distribution of suitability values for composite, depth and velocity for **Chinook salmon juvenile rearing** across river kilometers in the South Fork Walla Walla River, 2021."}

# Box-plot by rkm, Chinook spawning, South Fork
chnk_juv_2021_rkm_sf = hsi_raw %>%
  filter(year == "2021",
         scenario == "chnk_juv",
         str_starts(ID, "RKM"),
         str_ends(ID, "SF")) %>%
  ggplot(aes(x = ID, 
             y = value, 
             fill = metric)) +
  geom_boxplot() +
  facet_wrap(~ metric, nrow = 3) +
  theme_classic() +
  labs(x = "River Kilometer",
       y = "Suitability Index") +
  theme(plot.title = element_text(hjust = 0.5), legend.position = "top",
        axis.text.x = element_text(angle = 45, vjust = 0.5),
        axis.title.x = element_text(margin = margin(t = 10)),
        axis.title.y = element_text(margin = margin(r = 10)))
chnk_juv_2021_rkm_sf
```

```{r sthd-juv-box-rkm-ms, eval = F, results = 'hide', fig.cap = "Box plots showing the distribution of suitability values for composite, depth and velocity for **steelhead juvenile rearing** across river kilometers in the mainstem Upper Walla Walla River, 2021."}

# Box-plot by rkm, steelhead juvenile rearing, Mainstem
sthd_juv_2021_rkm_ms = hsi_raw %>%
  filter(year == "2021",
         scenario == "sthd_juv",
         str_starts(ID, "RKM"),
         str_ends(ID, "MS")) %>%
  ggplot(aes(x = ID, 
             y = value, 
             fill = metric)) +
  geom_boxplot() +
  facet_wrap(~ metric, nrow = 3) +
  theme_classic() +
  labs(x = "River Kilometer",
       y = "Suitability Index") +
  theme(plot.title = element_text(hjust = 0.5), legend.position = "top",
        axis.text.x = element_text(angle = 45, vjust = 0.5),
        axis.title.x = element_text(margin = margin(t = 10)),
        axis.title.y = element_text(margin = margin(r = 10)))
sthd_juv_2021_rkm_ms
```

```{r sthd-juv-box-rkm-nf, eval = F, results = 'hide', fig.cap = "Box plots showing the distribution of suitability values for composite, depth and velocity for **steelhead juvenile rearing** across river kilometers in the North Fork Walla Walla River, 2021."}

# Box-plot by rkm, steelhead juvenile rearing, North Fork
sthd_juv_2021_rkm_nf = hsi_raw %>%
  filter(year == "2021",
         scenario == "sthd_juv",
         str_starts(ID, "RKM"),
         str_ends(ID, "NF")) %>%
  ggplot(aes(x = ID, 
             y = value, 
             fill = metric)) +
  geom_boxplot() +
  facet_wrap(~ metric, nrow = 3) +
  theme_classic() +
  labs(x = "River Kilometer",
       y = "Suitability Index") +
  theme(plot.title = element_text(hjust = 0.5), legend.position = "top",
        axis.text.x = element_text(angle = 45, vjust = 0.5),
        axis.title.x = element_text(margin = margin(t = 10)),
        axis.title.y = element_text(margin = margin(r = 10)))
sthd_juv_2021_rkm_nf
```

```{r sthd-juv-box-rkm-sf, eval = F, results = 'hide', fig.cap = "Box plots showing the distribution of suitability values for composite, depth and velocity for **steelhead juvenile rearing** across river kilometers in the South Fork Walla Walla River, 2021."}

# Box-plot by rkm, steelhead juvenile rearing, South Fork
sthd_juv_2021_rkm_sf = hsi_raw %>%
  filter(year == "2021",
         scenario == "sthd_juv",
         str_starts(ID, "RKM"),
         str_ends(ID, "SF")) %>%
  ggplot(aes(x = ID, 
             y = value, 
             fill = metric)) +
  geom_boxplot() +
  facet_wrap(~ metric, nrow = 3) +
  theme_classic() +
  labs(x = "River Kilometer",
       y = "Suitability Index") +
  theme(plot.title = element_text(hjust = 0.5), legend.position = "top",
        axis.text.x = element_text(angle = 45, vjust = 0.5),
        axis.title.x = element_text(margin = margin(t = 10)),
        axis.title.y = element_text(margin = margin(r = 10)))
sthd_juv_2021_rkm_sf
```

